
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Numeric Methods Commonly Used in HARK &#8212; HARK latest documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="../../_static/override-nbsphinx-gallery.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=91d07486"></script>
    <script src="../../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/Gentle-Intro/Methods-Intro';</script>
    <link rel="canonical" href="https://docs.econ-ark.org/examples/Gentle-Intro/Methods-Intro.html" />
    <link rel="icon" href="../../_static/econ-ark-logo.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Directory of Consumption-Saving Models" href="Model-List.html" />
    <link rel="prev" title="Advanced and Uncommon HARK Concepts" href="Advanced-Intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="latest" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/econ-ark-logo.png" class="logo__image only-light" alt="HARK latest documentation - Home"/>
    <img src="../../_static/econ-ark-logo.png" class="logo__image only-dark pst-js-only" alt="HARK latest documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../docs/guides/index.html">
    Guides
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../../docs/overview/index.html">
    Overview & Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../docs/reference/index.html">
    Reference
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/Econ-ARK/HARK" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/econ_ark" title="Twitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/econ-ark/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-box fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://econ-ark.org" title="Econ-ARK" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../_static/econ-ark-logo.png" class="icon-link-image" alt="Econ-ARK"/></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../docs/guides/index.html">
    Guides
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../../docs/overview/index.html">
    Overview & Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../docs/reference/index.html">
    Reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/Econ-ARK/HARK" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/econ_ark" title="Twitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/econ-ark/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-box fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://econ-ark.org" title="Econ-ARK" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../_static/econ-ark-logo.png" class="icon-link-image" alt="Econ-ARK"/></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction to HARK</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../docs/overview/introduction.html">Introduction to HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/overview/ARKitecture.html">ARKitecture of Econ-ARK</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Learning About HARK</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Gentle-Intro-To-HARK.html">A Gentle Introduction to HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="Simulation-Intro.html">Simulating Microeconomic Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cycles-Intro.html">The Nature of Time for <code class="docutils literal notranslate"><span class="pre">AgentType</span></code>s</a></li>
<li class="toctree-l1"><a class="reference internal" href="Constructors-Intro.html">Constructed Attributes and Model Defaults</a></li>
<li class="toctree-l1"><a class="reference internal" href="Advanced-Intro.html">Advanced and Uncommon HARK Concepts</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Numeric Methods Commonly Used in HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="Model-List.html">Directory of Consumption-Saving Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="AgentType-Intro.html">Elements of an <code class="docutils literal notranslate"><span class="pre">AgentType</span></code> Subclass</a></li>
<li class="toctree-l1"><a class="reference internal" href="Market-Intro.html">“Macroeconomic” Models: the <code class="docutils literal notranslate"><span class="pre">Market</span></code> Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SequenceSpaceJacobians/SSJ_explanation.html">The Sequence Space Jacobian (SSJ) method</a></li>

<li class="toctree-l1"><a class="reference internal" href="../SequenceSpaceJacobians/SSJ-tutorial.html">Making HA-SSJ Matrices with HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SequenceSpaceJacobians/SSJ-advanced-examples.html">Advanced Examples of HA-SSJ’s</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Journeys/Journey-PhD.html">Journey: Economics PhD Student</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Consumption-Saving Models</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../ConsIndShockModel/PerfForesightConsumerType.html">Perfect Foresight Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../TractableBufferStockModel/TractableConsumerType.html">Tractable Buffer Stock Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsRepAgentModel/RepAgentConsumerType.html">Representative Agent Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsIndShockModel/IndShockConsumerType.html">Permanent and Transitory Income Shocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsIndShockModel/KinkedRconsumerType.html">Higher Interest Rate to Borrow than Save</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsMarkovModel/MarkovConsumerType.html">Discrete State with Markov Transitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsGenIncProcessModel/GenIncProcessConsumerType.html">Generalized Income Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsAggShockModel/AggShockConsumerType.html">Aggregate Productivity Shocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsBequestModel/example_WarmGlowBequest.html">Warm-Glow Bequest Motive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsBequestModel/example_WarmGlowBequestPort.html">Warm-Glow Bequest Motive and Portfolio Choice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsWealthUtilityModel/WealthUtilityConsumerType.html">Wealth-in-Utility Multiplicatively with Consumption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsWealthUtilityModel/CapitalistSpiritConsumerType.html">Wealth-in-Utility Additively with Consumption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsPortfolioModel/RiskyAssetConsumerType.html">Assets with Risky Returns: Portfolio Choice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsPortfolioModel/PortfolioConsumerType.html">Advanced Options for Portfolio Allocation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsPortfolioModel/SequentialPortfolioConsumerType.html">Portfolio Allocation with “Sequential Solvers”</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsWealthPortfolioModel/example_WealthPortfolio.html">Multiplicative Wealth-in-Utility with Portfolio Choice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsLaborModel/LaborIntMargConsumerType.html">Intensive Margin Labor Supply Choice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsPrefShockModel/PrefShockConsumerType.html">Preference Shocks to Consumption Utility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsHealthModel/BasicHealthConsumerType.html">Basic Health Investment</a></li>

<li class="toctree-l1"><a class="reference internal" href="../ConsMedModel/MedShockConsumerType.html">Medical Care on the Intensive Margin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsMedModel/MedExtMargConsumerType.html">Medical Care on the Extensive Margin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsRiskyContribModel/RiskyContribConsumerType.html">“Risky Contribution” Model</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../LifecycleModel/LifecycleModel.html">A Life Cycle Model: The Distribution of Assets By Age</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SequenceSpaceJacobians/Transition_Matrix_Example.html">Using Transition Matrix Methods under IndShockConsumerType</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SequenceSpaceJacobians/Jacobian_Example.html">Computing Heterogenous Agent Sequence Space Jacobians in HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SequenceSpaceJacobians/KS-HARK-presentation.html">Solving Krusell Smith Model with HARK and SSJ</a></li>


<li class="toctree-l1"><a class="reference internal" href="../SequenceSpaceJacobians/HANKFiscal_example.html">HARK and the Sequence Space Jacobian (SSJ) Method</a></li>





</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Extras</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../docs/CHANGELOG.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/license.html">License</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../docs/overview/index.html" class="nav-link">Overview</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Numeric Methods Commonly Used in HARK</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="admonition note">
  This page was generated from
  <a class="reference external" href="https://github.com/econ-ark/HARK/tree/main/examples/Gentle-Intro/Methods-Intro.ipynb">examples/Gentle-Intro/Methods-Intro.ipynb</a>.
  <br />
  Interactive online version:
  <span style="white-space: nowrap;"><a href="https://mybinder.org/v2/gh/econ-ark/HARK/main?filepath=examples/Gentle-Intro/Methods-Intro.ipynb"><img alt="Binder badge" src="https://mybinder.org/badge_logo.svg" style="vertical-align:text-bottom"></a>.</span>
  <a href="Methods-Intro.ipynb" class="reference download internal" download>Download notebook</a>.
</div><section id="Numeric-Methods-Commonly-Used-in-HARK">
<h1>Numeric Methods Commonly Used in HARK<a class="headerlink" href="#Numeric-Methods-Commonly-Used-in-HARK" title="Link to this heading">#</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">HARK.utilities</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_funcs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">HARK.interpolation</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearInterp</span><span class="p">,</span> <span class="n">CubicInterp</span>
</pre></div>
</div>
</div>
<p>HARK uses a variety of numeric methods to solve and simulate models; this notebook discusses some of those methods. Much of what’s done in HARK (and described here) is commonly known, but there are some less-than-common techniques as well.</p>
<section id="The-Endogenous-Grid-Method">
<h2>The Endogenous Grid Method<a class="headerlink" href="#The-Endogenous-Grid-Method" title="Link to this heading">#</a></h2>
<p>Essentially all consumption-saving models in HARK are solved using the <strong>endogenous grid method</strong>, or EGM for short. This technique was first published in 2005, but Chris Carroll had been using it for over a decade before then– and believed that everyone else was using it too! It has since been extended by many others to incorporate wider arrays of models, but the main logic remains the same.</p>
<section id="Simple-Consumption-Saving-Model">
<h3>Simple Consumption-Saving Model<a class="headerlink" href="#Simple-Consumption-Saving-Model" title="Link to this heading">#</a></h3>
<p>We’ll present a very basic consumption-saving model here to quickly motivate the EGM:</p>
<p><span class="math">\begin{eqnarray*}
V_t(M_t) &=& \max_{C_t} U(C_t) + \beta \mathbb{E} \left[ V_{t+1}(M_{t+1})\right] ~~ \text{s.t.}\\
A_t &=& M_t - C_t,\\
A_t &\geq& 0,\\
M_{t+1} &=& R A_t + Y_{t+1},\\
Y_{t+1} &\sim& F,\\
U(C) &=& \frac{C^{1-\rho}}{1-\rho}.
\end{eqnarray*}</span></p>
<p>This is a basic consumption-saving framework with iid income drawn from some distribution <span class="math notranslate nohighlight">\(F\)</span>, CRRA utility, geometric discounting, and one risk-free asset. The problem in period <span class="math notranslate nohighlight">\(t\)</span> is to find optimal consumption <span class="math notranslate nohighlight">\(C_t\)</span> as a function of market resources <span class="math notranslate nohighlight">\(M_t\)</span>, subject to income risk and assuming that the problem has already been solved back to period <span class="math notranslate nohighlight">\(t+1\)</span>. For simplicity, let’s assume that <span class="math notranslate nohighlight">\(V_{t+1}(\cdot)\)</span> is strictly concave (it <em>is</em> strictly concave if this
is the model in all future periods, but we won’t bother proving that here).</p>
</section>
<section id="Traditional-Solution-Method">
<h3>Traditional Solution Method<a class="headerlink" href="#Traditional-Solution-Method" title="Link to this heading">#</a></h3>
<p>Assuming an interior solution for <span class="math notranslate nohighlight">\(C_t\)</span>, the first order condition for optimality is the first derivative of the maximand with respect to <span class="math notranslate nohighlight">\(C_t\)</span>, equated to zero:</p>
<p><span class="math">\begin{equation*}
\text{maximand:} ~~ \frac{C_t^{1-\rho}}{1-\rho} + \beta \mathbb{E} \left[ V_{t+1}(R (M_t - C_t) + Y_{t+1})\right].
\end{equation*}</span> <span class="math">\begin{equation*}
\text{FOC:} ~~ C_t^{-\rho} - \beta R \mathbb{E} \left[ V_{t+1}'(R (M_t - C_t) + Y_{t+1})\right] = 0.
\end{equation*}</span></p>
<p>The “traditional” way to solve this model is to choose a finite grid of <span class="math notranslate nohighlight">\(M_t\)</span> values, then search for the <span class="math notranslate nohighlight">\(C_t\)</span> that satisfies the FOC for each one. That is, we suppose that the agent <em>is</em> at some state <span class="math notranslate nohighlight">\(M_t\)</span> and ask <em>what they should optimally do now</em>.</p>
<p>This approach involves using a numeric rootfinder to solve the FOC; each “guess” of <span class="math notranslate nohighlight">\(C_t\)</span> for some <span class="math notranslate nohighlight">\(M_t\)</span> requires computing the expectation over <span class="math notranslate nohighlight">\(Y_{t+1}\)</span>. This is a costly process that involves a lot of “wasted work”: if a pair <span class="math notranslate nohighlight">\((M_t,C_t)\)</span> does not satisfy the FOC, we <em>throw it out</em> and try again.</p>
</section>
<section id="Endogenous-Grid-Method-Math">
<h3>Endogenous Grid Method Math<a class="headerlink" href="#Endogenous-Grid-Method-Math" title="Link to this heading">#</a></h3>
<p>The endogenous grid method eliminates that wasted work by flipping the problem around. Rather than considering what the agent should do <em>now</em> at some <span class="math notranslate nohighlight">\(M_t\)</span>, it instead hypothesizes that the agent has <em>already</em> consumed and is <em>ending</em> the period with <span class="math notranslate nohighlight">\(A_t\)</span> in retained assets. EGM asks how much the agent must have <em>just consumed</em> if they acted optimally and ended the period with <span class="math notranslate nohighlight">\(A_t\)</span>.</p>
<p>Mathematically, this involves defining the agent’s “end-of-period value function”, sometimes called a “continuation value function”. It maps from values of <span class="math notranslate nohighlight">\(A_t\)</span> to the expected sum of future utility flows.</p>
<p><span class="math">\begin{equation*}
\mathfrak{V}_t(A_t) = \beta \mathbb{E} \left[ V_t(R A_t + Y_{t+1}) \right].
\end{equation*}</span></p>
<p>The marginal value of end-of-period assets is:</p>
<p><span class="math">\begin{equation*}
\mathfrak{V}_t'(A_t) = \beta R \mathbb{E} \left[ V_t'(R A_t + Y_{t+1}) \right].
\end{equation*}</span></p>
<p>The first order condition for optimality can thus be re-expressed in “EGM form” using these definitions:</p>
<p><span class="math">\begin{equation*}
\text{maximand:} ~~ \frac{C_t^{1-\rho}}{1-\rho} + \mathfrak{V}_t(A_t).
\end{equation*}</span></p>
<p><span class="math">\begin{equation*}
\text{FOC:} ~~ C_t^{-\rho} - \mathfrak{V}_t'(A_t) = 0.
\end{equation*}</span></p>
<p>The FOC in EGM form can be solved very easily to find <span class="math notranslate nohighlight">\(C_t\)</span>:</p>
<p><span class="math">\begin{equation*}
C_t = \mathfrak{V}_t'(A_t)^{-1/\rho}.
\end{equation*}</span></p>
<p>Moreover, if we know end-of-period assets <span class="math notranslate nohighlight">\(A_t\)</span> and how much the agent just consumed <span class="math notranslate nohighlight">\(C_t\)</span>, we also know how much market resources <span class="math notranslate nohighlight">\(M_t\)</span> they had when they made their decision, from the intraperiod budget constraint:</p>
<p><span class="math">\begin{equation*}
A_t = M_t - C_t \Longrightarrow M_t = A_t + C_t.
\end{equation*}</span></p>
</section>
<section id="Algorithm-Summary">
<h3>Algorithm Summary<a class="headerlink" href="#Algorithm-Summary" title="Link to this heading">#</a></h3>
<p>The preceding math suggests the following general algorithm for EGM:</p>
<ol class="arabic simple">
<li><p>Choose a grid of end-of-period states <span class="math notranslate nohighlight">\(A_t\)</span> on <span class="math notranslate nohighlight">\([0, \infty]\)</span></p></li>
<li><p>Evaluate marginal value of end-of-period assets <span class="math notranslate nohighlight">\(\mathfrak{V}_t'(A_t)\)</span> for each gridpoint</p></li>
<li><p>Find the associated optimal <span class="math notranslate nohighlight">\(C_t\)</span> for each <span class="math notranslate nohighlight">\(A_t\)</span> using the inverted FOC</p></li>
<li><p>Find the <span class="math notranslate nohighlight">\(M_t\)</span> gridpoint from which <span class="math notranslate nohighlight">\(C_t\)</span> was chosen to reach each <span class="math notranslate nohighlight">\(A_t\)</span></p></li>
<li><p>Add an additional <span class="math notranslate nohighlight">\((M_t, C_t)\)</span> gridpoint at <span class="math notranslate nohighlight">\((0,0)\)</span></p></li>
<li><p>Construct the consumption function as a linear interpolation of <span class="math notranslate nohighlight">\(C_t\)</span> on <span class="math notranslate nohighlight">\(M_t\)</span></p></li>
<li><p>Represent the marginal value function <span class="math notranslate nohighlight">\(V_t'(M_t)\)</span> as the composition of the marginal utility function and the consumption function</p></li>
</ol>
<p>The final step relies on the typical envelope condition for consumption-saving models, which we don’t elaborate on here.</p>
<p>EGM greatly accelerates solving the model because it yields one point on the consumption function for each numeric expectation (over future marginal value) that is computed. That is, there is no “wasted work” at all. Moreover, EGM <em>exactly</em> identifies where the borrowing constraint <span class="math notranslate nohighlight">\(A_t \geq 0\)</span> begins to bind. In contrast, the “standard approach” involves checking various <span class="math notranslate nohighlight">\(M_t\)</span> values and finding that the agent should consume all market resources, but never finds the exact point
where <span class="math notranslate nohighlight">\(C_t = M_t\)</span> exactly satisfies the FOC.</p>
<p>Essentially all of the consumption-saving models in HARK are more complex than the example here, and thus the math is somewhat more complicated in practice. But the core logic is the same: consider the agent’s (marginal) valuation from the perspective of the <em>end</em> of the period and recover their optimal control(s) from that.</p>
<p>Throughout HARK’s solvers, the prefix <code class="docutils literal notranslate"><span class="pre">EndOfPrd</span></code> is used to denote “end-of-period” objects and values. E.g. <code class="docutils literal notranslate"><span class="pre">EndOfPrd_vP</span></code> is marginal value as of the end of period <span class="math notranslate nohighlight">\(t\)</span>.</p>
</section>
</section>
<section id="Interpolation-Methods">
<h2>Interpolation Methods<a class="headerlink" href="#Interpolation-Methods" title="Link to this heading">#</a></h2>
<p>HARK includes many interpolator classes in <code class="docutils literal notranslate"><span class="pre">HARK.interpolation</span></code>. We use custom interpolation code to enable compatibility with the concept of “distance” between objects (as part of <code class="docutils literal notranslate"><span class="pre">MetricObject</span></code>).</p>
<section id="Linear-Spline-Interpolation">
<h3>Linear Spline Interpolation<a class="headerlink" href="#Linear-Spline-Interpolation" title="Link to this heading">#</a></h3>
<p>The most common interpolation technique in HARK is basic linear spline interpolation using <code class="docutils literal notranslate"><span class="pre">LinearInterp</span></code>. The basic syntax for making a linear splint interpolant is simple: <code class="docutils literal notranslate"><span class="pre">LinearInterp(x_values,</span> <span class="pre">y_values)</span></code>. Let’s make an approximation of the log function as a demonstration.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">LinearInterp</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
<span class="n">plot_funcs</span><span class="p">([</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">],</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_Gentle-Intro_Methods-Intro_16_0.png" src="../../_images/examples_Gentle-Intro_Methods-Intro_16_0.png" />
</div>
</div>
<p>This figure is useful for demonstrating some of the details of <code class="docutils literal notranslate"><span class="pre">LinearInterp</span></code>:</p>
<ul class="simple">
<li><p>By default, there is <em>no lower extrapolation</em>; the interpolant returns NaN. We made this choice because the most common context for interpolation in HARK is over money, which has a meaningful lower bound below which <em>the function is not defined</em>.</p></li>
<li><p>To use linear extrapolation below the lowest gridpoint, pass the option <code class="docutils literal notranslate"><span class="pre">lower_extrap=True</span></code> at instantiation.</p></li>
<li><p>By default, <code class="docutils literal notranslate"><span class="pre">LinearInterp</span></code> uses linear extrapolation above the highest gridpoint. Again, this is because the most common context for interpolation in HARK is over money, for which there is no meaningful upper bound. Moreover, many of the functions being interpolated <em>really do</em> approach a linear limit as <span class="math notranslate nohighlight">\(x\)</span> becomes large.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LinearInterp</span></code> has optional inputs of <code class="docutils literal notranslate"><span class="pre">intercept_limit</span></code> and <code class="docutils literal notranslate"><span class="pre">slope_limit</span></code> to specify a linear function that the interpolant should approach as <span class="math notranslate nohighlight">\(x\)</span> becomes arbitrarily large. The interpolant will use “decay extrapolation”: the level and slope of the function is preserved at the highest gridpoint, and the extrapolation is an exponential decay to the limiting function above the top gridpoint.</p></li>
</ul>
</section>
<section id="Cubic-Spline-Interpolation">
<h3>Cubic Spline Interpolation<a class="headerlink" href="#Cubic-Spline-Interpolation" title="Link to this heading">#</a></h3>
<p>The linear spline approximation of the log function is noticeably inaccurate at low values of <span class="math notranslate nohighlight">\(x\)</span>– the orange interpolant is visibly below the blue log function. As you likely know, linear spline interpolation’s accuracy depends on the local <em>curvature</em> of the true function. Intuitively, the more the function bends, the less well it can be approximated by a series of linear segments.</p>
<p>HARK’s second workhorse 1D interpolator is <code class="docutils literal notranslate"><span class="pre">CubicInterp</span></code>. The basic syntax is identical to <code class="docutils literal notranslate"><span class="pre">LinearInterp</span></code>, but with an additional third argument of <code class="docutils literal notranslate"><span class="pre">dydx_values</span></code>. Let’s continue the log example from above to demonstrate.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dYdX</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">X</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">CubicInterp</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">dYdX</span><span class="p">)</span>
<span class="n">plot_funcs</span><span class="p">([</span><span class="n">f</span><span class="p">,</span> <span class="n">h</span><span class="p">],</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_Gentle-Intro_Methods-Intro_19_0.png" src="../../_images/examples_Gentle-Intro_Methods-Intro_19_0.png" />
</div>
</div>
<p>Now the orange interpolant covers up the true blue function even at low <span class="math notranslate nohighlight">\(x\)</span>. Note that lower extrapolation is still off by default, and that linear extrapolation is used above the top gridpoint.</p>
<p>Accuracy is easier to see if we plot the differnce between the interpolants and the true function.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g_error</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">h_error</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">h</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">plot_funcs</span><span class="p">([</span><span class="n">g_error</span><span class="p">,</span> <span class="n">h_error</span><span class="p">],</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_Gentle-Intro_Methods-Intro_21_0.png" src="../../_images/examples_Gentle-Intro_Methods-Intro_21_0.png" />
</div>
</div>
<p>Here, the blue curve is the error for the linear spline interpolant and the orange curve is the error for the cubic spline interpolant. Note that the linear extrapolation is <em>slightly</em> more accurate for the cubic interpolant. That’s because its initial slope is based on the <em>true slope</em> at the highest gridpoint, whereas the extrapolation for the linear spline interpolant is based on the <em>secant</em> of the two highest interpolation nodes.</p>
<p><code class="docutils literal notranslate"><span class="pre">CubicInterp</span></code> has the same options as <code class="docutils literal notranslate"><span class="pre">LinearInterp</span></code> for enabling lower extrapolation (linear) and using “exponential decay” extrapolation (upper).</p>
</section>
<section id="Multidimensional-Interpolators">
<h3>Multidimensional Interpolators<a class="headerlink" href="#Multidimensional-Interpolators" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">HARK.interpolation</span></code> also has multilinear interpolators for functions with 2, 3, and 4 arguments. These are, respectively, <code class="docutils literal notranslate"><span class="pre">BilinearInterp</span></code>, <code class="docutils literal notranslate"><span class="pre">TrilinearInterp</span></code>, and <code class="docutils literal notranslate"><span class="pre">QuadlinearInterp</span></code> (which maybe should be <code class="docutils literal notranslate"><span class="pre">QuadralinearInterp</span></code>).</p>
<p>The syntax for instantiating multilinear interpolants is <em>slightly</em> different from the 1D interpolants: the function values are passed <em>before</em> the grids rather than after. Thus the instantiating statements are formatted as:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">=</span> <span class="pre">BilinearInterp(f_values,</span> <span class="pre">x_grid,</span> <span class="pre">y_grid)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">g</span> <span class="pre">=</span> <span class="pre">TrilinearInterp(f_values,</span> <span class="pre">x_grid,</span> <span class="pre">y_grid,</span> <span class="pre">z_grid)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">h</span> <span class="pre">=</span> <span class="pre">QuadlinearInterp(f_values,</span> <span class="pre">w_grid,</span> <span class="pre">x_grid,</span> <span class="pre">y_grid,</span> <span class="pre">z_grid)</span></code></p></li>
</ul>
<p>Note that the <em>internal</em> names for the dimensions change from <span class="math notranslate nohighlight">\(x,y,z\)</span> to <span class="math notranslate nohighlight">\(w,x,y,z\)</span> when moving from 3 to 4 dimensions. This mostly only matters for calling the derivative methods (see below).</p>
<p>In all cases, the grids should be 1D arrays (or just lists of floats) and <code class="docutils literal notranslate"><span class="pre">f_values</span></code> should be an ND array with each dimension equal to the size of the corresponding grid. The values represent function values at the mesh of the grids.</p>
</section>
<section id="Who-Interpolates-the-Interpolators?-(We-Do)">
<h3>Who Interpolates the Interpolators? (We Do)<a class="headerlink" href="#Who-Interpolates-the-Interpolators?-(We-Do)" title="Link to this heading">#</a></h3>
<p>Partly because HARK solvers use EGM a lot, we often end up with interpolation nodes that share <span class="math notranslate nohighlight">\(y\)</span> values but have different <span class="math notranslate nohighlight">\(x\)</span> values within each <span class="math notranslate nohighlight">\(y\)</span> value. For example, in <code class="docutils literal notranslate"><span class="pre">GeneralIncomeProcessModel</span></code>, permanent/persistent income is not normalized out and is present as a state variable. When using EGM, starting from a mesh grid of <span class="math notranslate nohighlight">\((A_t, P_t)\)</span> values will yield a set of <span class="math notranslate nohighlight">\((M_t,P_t)\)</span> endogenous gridpoints that share <span class="math notranslate nohighlight">\(P_t\)</span> values but have a different set of
<span class="math notranslate nohighlight">\(M_t\)</span> values within each one. Thus <code class="docutils literal notranslate"><span class="pre">BilinearInterp</span></code> cannot be used to interpolate this data.</p>
<p>Instead, we construct a set of 1D interpolators over <span class="math notranslate nohighlight">\(M_t\)</span>, one for each value of <span class="math notranslate nohighlight">\(P_t\)</span>, and then <em>interpolate the interpolators</em> with the class <code class="docutils literal notranslate"><span class="pre">LinearInterpOnInterp1D</span></code>. The syntax to instantiate this class is straightforward:</p>
<p><code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">=</span> <span class="pre">LinearInterpOnInterp1D(list_of_interpolants_over_x,</span> <span class="pre">y_grid)</span></code></p>
<p>When a <code class="docutils literal notranslate"><span class="pre">LinearInterpOnInterp1D</span></code> instance is called as a function, it finds the “bounding” <span class="math notranslate nohighlight">\(y\)</span> values for each query point, calculates the linear weight between them, and evaluates <em>both</em> “bounding” x-interpolants for each query point. It then returns the linearly weighted average of those values.</p>
<p>But wait, there’s more! <code class="docutils literal notranslate"><span class="pre">HARK.interpolation</span></code> has this kind of interpolator for <em>every</em> possibility up to interpolants with 4 arguments. That is, the following classes can all be used with analogous syntax:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">LinearInterpOnInterp1D</span></code> (2 arguments)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BilinearInterpOnInterp1D</span></code> (3 arguments)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TrilinearInterpOnInterp1D</span></code> (4 arguments)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LinearInterpOnInterp2D</span></code> (3 arguments)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BilinearInterpOnInterp2D</span></code> (4 arguments)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LinearInterpOnInterp3D</span></code> (4 arguments)</p></li>
</ul>
<p>Early in HARK’s development, we began coding a <code class="docutils literal notranslate"><span class="pre">BicubicInterp</span></code> interpolator, but realized that essentially no models have closed form cross-partial derivatives for their functions. This work was abandoned and is unlikely to be revived.</p>
</section>
<section id="Variable-Lower-Bounds">
<h3>Variable Lower Bounds<a class="headerlink" href="#Variable-Lower-Bounds" title="Link to this heading">#</a></h3>
<p>Sometimes the lower bound of a function’s domain with respect to one dimension can depend on the value of another dimension. Most commonly in the context of consumption-saving models, the lower bound of allowable cash-on-hand can depend on other state variables, like permanent income (you can borrow more if you have higher income) or house size (you can borrow against your home).</p>
<p>To handle this situation with continuous state variables (rather than discrete permanent income or house size, e.g.), HARK has special interpolators with the <code class="docutils literal notranslate"><span class="pre">VariableLowerBound</span></code> prefix. These are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">VariableLowerBoundFunc2D</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VariableLowerBoundFunc3D</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VariableLowerBoundFunc4D</span></code></p></li>
</ul>
<p>Each of these classes has identical syntax for instantiation:</p>
<p><code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">=</span> <span class="pre">VariableLowerBoundFuncND(some_ND_function,</span> <span class="pre">lower_bound_for_dim0_wrt_other_dims)</span></code></p>
<p>The input labeled <code class="docutils literal notranslate"><span class="pre">some_ND_function</span></code> should be a callable object that takes <span class="math notranslate nohighlight">\(N=2,3,4\)</span> arguments. Importantly, the lower bound of the first dimension (dim 0) should be zero <em>everywhere</em>. That is, <code class="docutils literal notranslate"><span class="pre">some_ND_function</span></code> should be a “regularized” or “shifted” function that aligns the lower bound to zero.</p>
<p>The input <code class="docutils literal notranslate"><span class="pre">lower_bound_for_dim0_wrt_other_dims</span></code> should be a callable object that takes <span class="math notranslate nohighlight">\(N-1\)</span> arguments, representing all but the first dimension (dim 0), and returns what the <em>actual</em> lower bound is in the first dimension.</p>
<p>When a <code class="docutils literal notranslate"><span class="pre">VariableLowerBoundFuncND</span></code> instance is called as a function, the arguments passed to it should be the <em>actual</em> values. The class handles the shift in the first argument based on the values of the other arguments.</p>
<p>In practice, most interpolated functions with a strict lower boundary have the nice feature that the function goes to zero (or some other common value) at that lower bound. For any policy function for a control variable that costs money, the function <em>must</em> approach zero as cash-on-hand approaches its lowest legal value– that’s part of the definition of what it means for a state to be valid!</p>
<p>This is a primary reason why this “regularizing” method improves accuracy: the actual relevant state variable is cash-on-hand-above-minimum-allowable-value. The <code class="docutils literal notranslate"><span class="pre">VariableLowerBound</span></code> functionality handles the translation from raw cash-on-hand to the state space with nicer properties.</p>
</section>
<section id="Derivative-Methods">
<h3>Derivative Methods<a class="headerlink" href="#Derivative-Methods" title="Link to this heading">#</a></h3>
<p>All of the interpolator classes in HARK inherit from superclasses called <code class="docutils literal notranslate"><span class="pre">HARKinterpolatorND</span></code>, for <span class="math notranslate nohighlight">\(N=1,2,3,4\)</span>. These superclasses define an interface or API for subclasses to build from. In particular, they handle re-shaping query input and output so that the interpolators can always assume they are working with vector inputs, which simplifies programming.</p>
<p>In addition, the <code class="docutils literal notranslate"><span class="pre">HARKinterpolatorND</span></code> interface provides derivative methods for all interpolator classes. Specifically, the following methods are defined for <em>all</em> interplators:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">derivativeX</span></code> : all interpolators</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">derivativeY</span></code> : 2D, 3D, and 4D interpolators</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">derivativeZ</span></code> : 3D and 4D interpolators</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">derivativeW</span></code> : 4D interpolators</p></li>
</ul>
<p>These represent the first derivative with respect to those dimensions. Additionally, 1D interpolators can call the <code class="docutils literal notranslate"><span class="pre">derivative</span></code> method with no dimension named; there’s no ambiguity if there’s one one argument!</p>
<p>All of the derivative methods correctly handle calls to “sub-interpolators”, including shifts from <code class="docutils literal notranslate"><span class="pre">VariableLowerBound</span></code>– that’s why we implemented the common interface! However, they do <em>not</em> currently have a backup plan if they encounter an error from trying to evaluate a derivative method on something that <em>doesn’t have one</em>.</p>
<p>Suppose you made a <code class="docutils literal notranslate"><span class="pre">LinearInterpOnInterp1D</span></code> and one of the interpolants w.r.t <span class="math notranslate nohighlight">\(x\)</span> wasn’t a subclass of <code class="docutils literal notranslate"><span class="pre">HARKinterpolator1D</span></code>– maybe it’s some custom function that you wrote, maybe it’s just a lambda function. If you try to query <code class="docutils literal notranslate"><span class="pre">MyInterpolant.derivativeX</span></code> at a point that requires calling <code class="docutils literal notranslate"><span class="pre">derivativeX</span></code> for that non-<code class="docutils literal notranslate"><span class="pre">HARKinterpolator1D</span></code> function, an error will be raised.</p>
<p>In the future, we will add a backup numeric derivative to prevent these kinds of errors.</p>
</section>
</section>
<section id="%22Pseudo-Inverse%22-Functions">
<h2>“Pseudo-Inverse” Functions<a class="headerlink" href="#%22Pseudo-Inverse%22-Functions" title="Link to this heading">#</a></h2>
<p>As noted above, linear spline interpolation is most accurate for functions that are not very curvy– they are well approximated by line segments. A critical type of function in consumption-saving models is <em>famously</em> curved: the value function with risk averse preferences.</p>
<p>The value function with (say) CRRA preferences is built from the sum of expectations of CRRA utility terms for each period. Thus it should not be <em>too</em> surprising that value functions look <em>kind of like</em> the utility function itself. CRRA utility can be quite curved, at least when <span class="math notranslate nohighlight">\(\rho\)</span> is not close to zero, and especially for small values of the input.</p>
<p>You <em>can</em> approximate a value function as a piecewise linear interpolant, but there will be a significant loss of accuracy. Moreover, if you try to explicitly maximize value using a linear spline interpolant for the value function, you will encounter some unfortunate (but explainable) numeric quirks.</p>
<p>HARK tries to avoid these issues by using a trick that we internally call the “pseudo-inverse”. Here’s the gist: if a value function is highly curved because it’s a bunch of highly curved utility terms added together, then maybe it would be <em>less curved</em> if we ran it through the inverse utility function first. In this case, “maybe” turns out to be “definitely”.</p>
<p>Whenever we refer to the “pseudo-inverse” value function, we mean the composition of the inverse utility (of consumption) function and the value function:</p>
<p><span class="math">\begin{equation*}
\widetilde{v}(m_t) = U^{-1}(v(m_t)).
\end{equation*}</span></p>
<p>As it turns out, the pseudo-inverse value function for a consumption-saving model <em>looks a lot like</em> a typical consumption function. It is <em>not</em> the same thing as the consumption function, it just <em>looks like</em> one in terms of its shape. In particular, it goes to zero at the lower bound of cash-on-hand, asymptotes to a linear function as cash-on-hand approaches its lower bound, and asymptotes to a (usually) <em>different</em> linear function as cash-on-hand becomes arbitrarily large. (These features
depend on some characteristics of the specific model). In short, the pseudo-inverse value function is “manageably curved”.</p>
<p>Whenever a value function is represented in HARK, we convert value levels to pseudo-inverse value levels and interpolate those. The class <code class="docutils literal notranslate"><span class="pre">ValueFuncCRRA</span></code> is used to represent the value function, with the simple instantiation syntax <code class="docutils literal notranslate"><span class="pre">ValueFuncCRRA(pseudo_inverse_interpolant,</span> <span class="pre">CRRA)</span></code>. When the interpolant is called as a function, it evaluates the pseudo-inverse value function and then applies the utility function to “re-curve” it.</p>
<p>In the HARK code, we use the suffix <code class="docutils literal notranslate"><span class="pre">Nvrs</span></code> to mean “pseudo-inverse”– it is an intentional misspelling of “inverse” because it is fake. E.g. a pseudo-inverse value function is often given the name <code class="docutils literal notranslate"><span class="pre">vNvrsFunc</span></code>.</p>
<p>In many consumption-saving contexts, we know the marginal value of market resources (the slope of the value function) as well as the level. To improve accuracy of the interpolant, we usually (but not always) use a <code class="docutils literal notranslate"><span class="pre">CubicInterp</span></code> to represent the pseudo-inverse marginal value function. When we do so, the slope of the pseudo-inverse value function (at its nodes) is calculated as:</p>
<p><span class="math">\begin{equation*}
\widetilde{v}'(m_t) = v'(m_t) (U^{-1})'(v(m_t)).
\end{equation*}</span></p>
<p>If you were wondering why <code class="docutils literal notranslate"><span class="pre">HARK.rewards</span></code> has weird functions like <code class="docutils literal notranslate"><span class="pre">CRRAutility_invP</span></code> in it, this why!</p>
<p>To represent the marginal value function, HARK interpolates the pseudo-inverse marginal value function– the composition of the inverse marginal utility function and the marginal value function. The interpolator class <code class="docutils literal notranslate"><span class="pre">MargValueFuncCRRA</span></code> uses analogous syntax to <code class="docutils literal notranslate"><span class="pre">ValueFuncCRRA</span></code>.</p>
<p>Of course, in many consumption-saving models, the marginal value function is simply the composition of the marginal utility function and the consumption function. In that case, the pseudo-inverse marginal value function <em>is</em> the consumption function!</p>
</section>
<section id="Lognormal-Discretization">
<h2>Lognormal Discretization<a class="headerlink" href="#Lognormal-Discretization" title="Link to this heading">#</a></h2>
<p>The default distribution of income shocks in HARK is a pair of permanent (or highly persistent) shocks and fully transitory shocks, both specified as lognormal (with some flexibility for representing “unemployment”). To compute expectations over income shocks, we discretize the lognormal distribution using an uncommon method, rather than Gaussian quadrature.</p>
<p>The default discretization method in HARK is <strong>equiprobable</strong>, generating <span class="math notranslate nohighlight">\(N\)</span> nodes each with <span class="math notranslate nohighlight">\(1/N\)</span> probability. The value of the <span class="math notranslate nohighlight">\(n\)</span>-th node equals the expectation of the distribution within its <span class="math notranslate nohighlight">\(n\)</span>-th quantile. E.g., for <span class="math notranslate nohighlight">\(N=7\)</span>, the second node is the expectation of the true distribution within about the 14th to 28th percentile (1/7 to 2/7).</p>
<p>The discretization method has some additional flexibility to put additional nodes in the far tails of the distribution. So in general, we want to be able to calculate the conditional expectation of a lognormal RV between two quantiles.</p>
<p><span class="math notranslate nohighlight">\(\newcommand{\pbot}{\underline{p}} \newcommand{\ptop}{\overline{p}}\)</span> <span class="math notranslate nohighlight">\(\newcommand{\qbot}{\underline{q}} \newcommand{\qtop}{\overline{q}}\)</span> <span class="math notranslate nohighlight">\(\newcommand{\zbot}{\underline{z}} \newcommand{\ztop}{\overline{z}}\)</span></p>
<p>The math for this conditional expectation doesn’t seem to be well known, so we are providing it here. Let <span class="math notranslate nohighlight">\(F\)</span> be a lognormal distribution characterized by underlying normal distribution with mean <span class="math notranslate nohighlight">\(\mu\)</span> and standard deviation <span class="math notranslate nohighlight">\(\sigma\)</span>. Suppose we want to know the expectation of <span class="math notranslate nohighlight">\(x \sim F\)</span> conditional on it being between the <span class="math notranslate nohighlight">\(\pbot\)</span> and <span class="math notranslate nohighlight">\(\ptop\)</span> quantiles, with <span class="math notranslate nohighlight">\(\pbot,\ptop \in [0,1]\)</span> and <span class="math notranslate nohighlight">\(\pbot &lt; \ptop\)</span>.</p>
<p>First, we find the upper and lower <span class="math notranslate nohighlight">\(z\)</span> values, in terms of standard deviations from the mean. Denoting the standard normal CDF as <span class="math notranslate nohighlight">\(\Phi\)</span>:</p>
<p><span class="math">\begin{eqnarray*}
\zbot &=& \Phi^{-1}(\pbot),\\
\ztop &=& \Phi^{-1}(\ptop).\\
\end{eqnarray*}</span></p>
<p>Next, the <span class="math notranslate nohighlight">\(z\)</span> values are adjusted to account for the asymmetric <em>shape</em> of the lognormal distribution:</p>
<p><span class="math">\begin{eqnarray*}
\qbot &=& \frac{\zbot - \sigma}{\sqrt{2}},\\
\qtop &=& \frac{\ztop - \sigma}{\sqrt{2}}.\\
\end{eqnarray*}</span></p>
<p>The expression for the conditional mean uses the <strong>error function</strong>, denoted <span class="math notranslate nohighlight">\(erf(\cdot)\)</span>, which has a domain of <span class="math notranslate nohighlight">\(\mathbb{R}\)</span> and a range of <span class="math notranslate nohighlight">\((-1,1)\)</span>.</p>
<p><span class="math">\begin{equation*}
\mathbb{E} \left[ x \sim F ~\bigg|~ \pbot \leq F(x) \leq \ptop \right] = \frac{erf(\qtop) - erf(\qbot)}{2(\ptop - \pbot)} \cdot \exp(\mu + \sigma^2 / 2).
\end{equation*}</span></p>
<p>The second factor is simply the unconditional expectation of <span class="math notranslate nohighlight">\(F\)</span>.</p>
<p>When actually computing these values, our code sometimes uses the <strong>complementary error function</strong>, defined as <span class="math notranslate nohighlight">\(erfc(\cdot) \equiv 1 - erf(\cdot)\)</span>. This is because the error function approaches one as <span class="math notranslate nohighlight">\(z\)</span> becomes large, limiting its numeric accuracy when differencing two values. Whereas <span class="math notranslate nohighlight">\(erfc\)</span> goes to zero (from above) as <span class="math notranslate nohighlight">\(z\)</span> becomes large, so relative numeric accuracy is preserved when comparing two “nearby” large values.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Advanced-Intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Advanced and Uncommon HARK Concepts</p>
      </div>
    </a>
    <a class="right-next"
       href="Model-List.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Directory of Consumption-Saving Models</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#The-Endogenous-Grid-Method">The Endogenous Grid Method</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Simple-Consumption-Saving-Model">Simple Consumption-Saving Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Traditional-Solution-Method">Traditional Solution Method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Endogenous-Grid-Method-Math">Endogenous Grid Method Math</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Algorithm-Summary">Algorithm Summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Interpolation-Methods">Interpolation Methods</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Linear-Spline-Interpolation">Linear Spline Interpolation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Cubic-Spline-Interpolation">Cubic Spline Interpolation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Multidimensional-Interpolators">Multidimensional Interpolators</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Who-Interpolates-the-Interpolators?-(We-Do)">Who Interpolates the Interpolators? (We Do)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Variable-Lower-Bounds">Variable Lower Bounds</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Derivative-Methods">Derivative Methods</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#%22Pseudo-Inverse%22-Functions">“Pseudo-Inverse” Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Lognormal-Discretization">Lognormal Discretization</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2026, Econ-ARK team.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 9.1.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>