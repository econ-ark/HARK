
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Portfolio Models in HARK &#8212; HARK latest documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="../../_static/override-nbsphinx-gallery.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=91d07486"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/ConsPortfolioModel/PortfolioConsumerType';</script>
    <link rel="canonical" href="https://docs.econ-ark.org/examples/ConsPortfolioModel/PortfolioConsumerType.html" />
    <link rel="icon" href="../../_static/econ-ark-logo.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Example Implementations of HARK.ConsumptionSaving.ConsRiskyAssetModel" href="RiskyAssetConsumerType.html" />
    <link rel="prev" title="Example ConsAggShockModel" href="../ConsAggShockModel/AggShockConsumerType.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="latest" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/econ-ark-logo.png" class="logo__image only-light" alt="HARK latest documentation - Home"/>
    <img src="../../_static/econ-ark-logo.png" class="logo__image only-dark pst-js-only" alt="HARK latest documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../docs/guides/index.html">
    Guides
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../../docs/overview/index.html">
    Overview & Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../docs/reference/index.html">
    Reference
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/Econ-ARK/HARK" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/econ_ark" title="Twitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/econ-ark/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-box fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://econ-ark.org" title="Econ-ARK" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../_static/econ-ark-logo.png" class="icon-link-image" alt="Econ-ARK"/></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../docs/guides/index.html">
    Guides
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../../docs/overview/index.html">
    Overview & Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../docs/reference/index.html">
    Reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/Econ-ARK/HARK" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/econ_ark" title="Twitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/econ-ark/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-box fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://econ-ark.org" title="Econ-ARK" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../_static/econ-ark-logo.png" class="icon-link-image" alt="Econ-ARK"/></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction to HARK</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../docs/overview/introduction.html">Introduction to HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/overview/ARKitecture.html">ARKitecture of Econ-ARK</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Learning About HARK</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Gentle-Intro/Gentle-Intro-To-HARK.html">A Gentle Introduction to HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Gentle-Intro/Simulation-Intro.html">Simulating Microeconomic Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Gentle-Intro/Cycles-Intro.html">The Nature of Time in HARK’s Microeconomic Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Gentle-Intro/Constructors-Intro.html">Constructed Attributes and Model Defaults</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Gentle-Intro/Advanced-Intro.html">Advanced and Uncommon HARK Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Gentle-Intro/Methods-Intro.html">Numeric Methods Commonly Used in HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Gentle-Intro/Model-List.html">Directory of Consumption-Saving Models in HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Gentle-Intro/AgentType-Intro.html">Elements of an AgentType Subclass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Gentle-Intro/Market-Intro.html">Solving for “Macroeconomic” Equilibrium in HARK: the <code class="docutils literal notranslate"><span class="pre">Market</span></code> class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SequenceSpaceJacobians/SSJ_explanation.html">The Sequence Space Jacobian (SSJ) method</a></li>

<li class="toctree-l1"><a class="reference internal" href="../SequenceSpaceJacobians/SSJ-tutorial.html">Making Heterogeneous Agent Sequence Space Jacobian Matrices in HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Journeys/Journey-PhD.html">Journey: Economics PhD Student</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">HARK Models</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../ConsIndShockModel/PerfForesightConsumerType.html">Perfect foresight consumption-saving</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsIndShockModel/IndShockConsumerType.html">Consumption-Saving model with Idiosyncratic Income Shocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsIndShockModel/KinkedRconsumerType.html">Consumption-Saving model with Idiosyncratic Income Shocks and Different Interest Rates on Borrowing and Saving</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsMarkovModel/MarkovConsumerType.html">Additional parameter value to solve an instance of MarkovConsumerType</a></li>





<li class="toctree-l1"><a class="reference internal" href="../ConsGenIncProcessModel/GenIncProcessConsumerType.html">Permanent versus Persistent Income Shocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsAggShockModel/AggShockConsumerType.html">Example ConsAggShockModel</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Portfolio Models in HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="RiskyAssetConsumerType.html">Example Implementations of <code class="docutils literal notranslate"><span class="pre">HARK.ConsumptionSaving.ConsRiskyAssetModel</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="SequentialPortfolioConsumerType.html">Consumption-Saving with Portfolio Allocation: Sequential Solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsLaborModel/LaborIntMargConsumerType.html">Consumption-Saving with Intensive Margin Labor Supply Choice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsPrefShockModel/PrefShockConsumerType.html">Multiplicative Shocks to Utility</a></li>




<li class="toctree-l1"><a class="reference internal" href="../ConsHealthModel/BasicHealthConsumerType.html">Basic Health Investment in a Consumption-Saving Model</a></li>

<li class="toctree-l1"><a class="reference internal" href="../ConsMedModel/MedShockConsumerType.html">Medical Care as a Consumption Good with Stochastic Demand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsMedModel/MedExtMargConsumerType.html">Consumption-Saving with Medical Care Choice on the Extensive Margin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsRepAgentModel/RepAgentConsumerType.html">Representative Agent Consumption-Saving Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsRiskyContribModel/RiskyContribConsumerType.html">“Risky Contribution” Model (UNKNOWN / UNEXPLAINED)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../LifecycleModel/LifecycleModel.html">A Life Cycle Model: The Distribution of Assets By Age</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SequenceSpaceJacobians/Transition_Matrix_Example.html">Using Transition Matrix Methods under IndShockConsumerType</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SequenceSpaceJacobians/Jacobian_Example.html">Computing Heterogenous Agent Sequence Space Jacobians in HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SequenceSpaceJacobians/KS-HARK-presentation.html">Solving Krusell Smith Model with HARK and SSJ</a></li>


<li class="toctree-l1"><a class="reference internal" href="../SequenceSpaceJacobians/HANKFiscal_example.html">HARK and the Sequence Space Jacobian (SSJ) Method</a></li>





</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Extras</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../docs/CHANGELOG.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/license.html">License</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../docs/overview/index.html" class="nav-link">Overview</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Portfolio Models in HARK</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="admonition note">
  This page was generated from
  <a class="reference external" href="https://github.com/econ-ark/HARK/tree/master/examples/ConsPortfolioModel/PortfolioConsumerType.ipynb">examples/ConsPortfolioModel/PortfolioConsumerType.ipynb</a>.
  <br />
  Interactive online version:
  <span style="white-space: nowrap;"><a href="https://mybinder.org/v2/gh/econ-ark/HARK/master?filepath=examples/ConsPortfolioModel/PortfolioConsumerType.ipynb"><img alt="Binder badge" src="https://mybinder.org/badge_logo.svg" style="vertical-align:text-bottom"></a>.</span>
  <a href="PortfolioConsumerType.ipynb" class="reference download internal" download>Download notebook</a>.
</div><section id="Portfolio-Models-in-HARK">
<h1>Portfolio Models in HARK<a class="headerlink" href="#Portfolio-Models-in-HARK" title="Link to this heading">#</a></h1>
<p>In this notebook, we consider the solution and simulation of a number of microeconomic problems in the context of optimal portfolio choice.</p>
<p>The agents in this model are first defined using the dictionary from the <code class="docutils literal notranslate"><span class="pre">PerfForesightConsumerType</span></code> class and additional attributes are added using the <code class="docutils literal notranslate"><span class="pre">IndShockConsumerType</span></code> class.</p>
<p>From there, the <code class="docutils literal notranslate"><span class="pre">ConsPortfolioDict</span></code> dictionary is introduced to create the <code class="docutils literal notranslate"><span class="pre">PortfolioConsumerType</span></code> and each of the subseqeunt agent types using it.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">copy</span><span class="w"> </span><span class="kn">import</span> <span class="n">copy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">time</span><span class="w"> </span><span class="kn">import</span> <span class="n">time</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">HARK.ConsumptionSaving.ConsIndShockModel</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">dist_params</span><span class="p">,</span>
    <span class="n">income_params</span><span class="p">,</span>
    <span class="n">init_lifecycle</span><span class="p">,</span>
    <span class="n">liv_prb</span><span class="p">,</span>
    <span class="n">time_params</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">HARK.ConsumptionSaving.ConsPortfolioModel</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">PortfolioConsumerType</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">HARK.utilities</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_funcs</span>
</pre></div>
</div>
</div>
<section id="1.-The-baseline-model-of-optimal-portfolio-choice">
<h2>1. The baseline model of optimal portfolio choice<a class="headerlink" href="#1.-The-baseline-model-of-optimal-portfolio-choice" title="Link to this heading">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use default parameters that are built into the AgentType subclass</span>
<span class="n">ConsPortfolioDict</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make and solve an example portfolio choice consumer type</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Now solving an example portfolio choice problem; this might take a moment...&quot;</span><span class="p">)</span>
<span class="n">MyType</span> <span class="o">=</span> <span class="n">PortfolioConsumerType</span><span class="p">(</span><span class="o">**</span><span class="n">ConsPortfolioDict</span><span class="p">)</span>
<span class="n">MyType</span><span class="o">.</span><span class="n">cycles</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">MyType</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">MyType</span><span class="o">.</span><span class="n">cFunc</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyType</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">cFuncAdj</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MyType</span><span class="o">.</span><span class="n">T_cycle</span><span class="p">)]</span>
<span class="n">MyType</span><span class="o">.</span><span class="n">ShareFunc</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyType</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">ShareFuncAdj</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MyType</span><span class="o">.</span><span class="n">T_cycle</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Solving an infinite horizon portfolio choice problem took &quot;</span>
    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>
    <span class="o">+</span> <span class="s2">&quot; seconds.&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Now solving an example portfolio choice problem; this might take a moment...
Solving an infinite horizon portfolio choice problem took 9.946223974227905 seconds.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the consumption and risky-share functions</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Consumption function over market resources:&quot;</span><span class="p">)</span>
<span class="n">plot_funcs</span><span class="p">(</span><span class="n">MyType</span><span class="o">.</span><span class="n">cFunc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Risky asset share as a function of market resources:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optimal (blue) versus Theoretical Limit (orange)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Normalized Market Resources&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Portfolio Share&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="c1"># Since we are using a discretization of the lognormal distribution,</span>
<span class="c1"># the limit is numerically computed and slightly different from</span>
<span class="c1"># the analytical limit obtained by Merton and Samuelson for infinite wealth</span>
<span class="n">plot_funcs</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">MyType</span><span class="o">.</span><span class="n">ShareFunc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">MyType</span><span class="o">.</span><span class="n">ShareLimit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">m</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">200.0</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Consumption function over market resources:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_ConsPortfolioModel_PortfolioConsumerType_5_1.png" src="../../_images/examples_ConsPortfolioModel_PortfolioConsumerType_5_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Risky asset share as a function of market resources:
Optimal (blue) versus Theoretical Limit (orange)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_ConsPortfolioModel_PortfolioConsumerType_5_3.png" src="../../_images/examples_ConsPortfolioModel_PortfolioConsumerType_5_3.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now simulate this consumer type</span>
<span class="n">MyType</span><span class="o">.</span><span class="n">track_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cNrm&quot;</span><span class="p">,</span> <span class="s2">&quot;Share&quot;</span><span class="p">,</span> <span class="s2">&quot;aNrm&quot;</span><span class="p">,</span> <span class="s2">&quot;t_age&quot;</span><span class="p">]</span>
<span class="n">MyType</span><span class="o">.</span><span class="n">T_sim</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">MyType</span><span class="o">.</span><span class="n">initialize_sim</span><span class="p">()</span>
<span class="n">MyType</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;cNrm&#39;: array([[0.94449375, 1.05100456, 0.9356256 , ..., 0.98425683, 0.85612338,
         1.17989959],
        [0.92584352, 1.04320533, 0.70324769, ..., 1.00654201, 0.9036357 ,
         1.10969382],
        [0.93661413, 1.01547995, 0.39485473, ..., 0.96439858, 0.90337007,
         1.05355431],
        ...,
        [0.93032901, 1.66761254, 1.15575218, ..., 1.32799353, 1.05324817,
         1.13988003],
        [0.93197068, 1.49486035, 1.08335149, ..., 1.24391658, 1.00136163,
         1.08439969],
        [0.9545978 , 1.53367694, 1.08795946, ..., 1.31940141, 1.03070202,
         1.10826285]]),
 &#39;Share&#39;: array([[1.        , 1.        , 1.        , ..., 1.        , 1.        ,
         1.        ],
        [1.        , 1.        , 1.        , ..., 1.        , 1.        ,
         1.        ],
        [1.        , 1.        , 1.        , ..., 1.        , 1.        ,
         1.        ],
        ...,
        [1.        , 0.86978448, 1.        , ..., 1.        , 1.        ,
         1.        ],
        [1.        , 1.        , 1.        , ..., 1.        , 1.        ,
         1.        ],
        [1.        , 0.96980028, 1.        , ..., 1.        , 1.        ,
         1.        ]]),
 &#39;aNrm&#39;: array([[0.57340032, 1.15100405, 0.5408086 , ..., 0.74710998, 0.31873697,
         2.23779631],
        [0.50702748, 1.09691301, 0.11566926, ..., 0.86648847, 0.43800078,
         1.60717581],
        [0.54430854, 0.91879238, 0.        , ..., 0.65458599, 0.43723903,
         1.16920216],
        ...,
        [0.52205593, 7.87694693, 2.01268514, ..., 3.75606929, 1.16701567,
         1.8690813 ],
        [0.52786829, 5.68343548, 1.39267564, ..., 2.86797932, 0.83741291,
         1.40090496],
        [0.61315991, 6.16146305, 1.42910594, ..., 3.6625533 , 1.01374387,
         1.59510094]]),
 &#39;t_age&#39;: array([[ 1.,  1.,  1., ...,  1.,  1.,  1.],
        [ 2.,  2.,  2., ...,  2.,  2.,  2.],
        [ 3.,  3.,  3., ...,  3.,  3.,  3.],
        ...,
        [ 4., 15., 32., ..., 75., 12., 76.],
        [ 5., 16., 33., ..., 76., 13., 77.],
        [ 6., 17., 34., ..., 77., 14., 78.]])}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;For derivation of the numerical limiting portfolio share&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;as market resources approach infinity, see&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;https://www.econ2.jhu.edu/people/ccarroll/public/lecturenotes/AssetPricing/Portfolio-CRRA/&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>




For derivation of the numerical limiting portfolio share
as market resources approach infinity, see
https://www.econ2.jhu.edu/people/ccarroll/public/lecturenotes/AssetPricing/Portfolio-CRRA/
</pre></div></div>
</div>
</section>
<section id="2.-Discrete-portfolio-choice">
<h2>2. Discrete portfolio choice<a class="headerlink" href="#2.-Discrete-portfolio-choice" title="Link to this heading">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make another example type, but this one optimizes risky portfolio share only</span>
<span class="c1"># on the discrete grid of values implicitly chosen by RiskyCount, using explicit</span>
<span class="c1"># value maximization.</span>
<span class="n">DiscConsPortfolioDict</span> <span class="o">=</span> <span class="n">ConsPortfolioDict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">DiscConsPortfolioDict</span><span class="p">[</span><span class="s2">&quot;DiscreteShareBool&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1"># Have to actually construct value function for this to work</span>
<span class="n">DiscConsPortfolioDict</span><span class="p">[</span><span class="s2">&quot;vFuncBool&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the discrete type using the dictionary, then change relevant attributes</span>
<span class="n">DiscreteType</span> <span class="o">=</span> <span class="n">PortfolioConsumerType</span><span class="p">(</span><span class="o">**</span><span class="n">DiscConsPortfolioDict</span><span class="p">)</span>
<span class="n">DiscreteType</span><span class="o">.</span><span class="n">cycles</span> <span class="o">=</span> <span class="mi">0</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Now solving a discrete choice portfolio problem; this might take a minute...&quot;</span><span class="p">)</span>

<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">DiscreteType</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">DiscreteType</span><span class="o">.</span><span class="n">cFunc</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">DiscreteType</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">cFuncAdj</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DiscreteType</span><span class="o">.</span><span class="n">T_cycle</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">DiscreteType</span><span class="o">.</span><span class="n">ShareFunc</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">DiscreteType</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">ShareFuncAdj</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DiscreteType</span><span class="o">.</span><span class="n">T_cycle</span><span class="p">)</span>
<span class="p">]</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Solving an infinite horizon discrete portfolio choice problem took &quot;</span>
    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>
    <span class="o">+</span> <span class="s2">&quot; seconds.&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Now solving a discrete choice portfolio problem; this might take a minute...
Solving an infinite horizon discrete portfolio choice problem took 21.797322034835815 seconds.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the consumption and risky-share functions</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Consumption function over market resources:&quot;</span><span class="p">)</span>
<span class="n">plot_funcs</span><span class="p">(</span><span class="n">DiscreteType</span><span class="o">.</span><span class="n">cFunc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Risky asset share as a function of market resources:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optimal (blue) versus Theoretical Limit (orange)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Normalized Market Resources&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Portfolio Share&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="c1"># Since we are using a discretization of the lognormal distribution,</span>
<span class="c1"># the limit is numerically computed and slightly different from</span>
<span class="c1"># the analytical limit obtained by Merton and Samuelson for infinite wealth</span>
<span class="n">plot_funcs</span><span class="p">(</span>
    <span class="p">[</span><span class="n">DiscreteType</span><span class="o">.</span><span class="n">ShareFunc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">DiscreteType</span><span class="o">.</span><span class="n">ShareLimit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">m</span><span class="p">)],</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">200.0</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Consumption function over market resources:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_ConsPortfolioModel_PortfolioConsumerType_11_1.png" src="../../_images/examples_ConsPortfolioModel_PortfolioConsumerType_11_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Risky asset share as a function of market resources:
Optimal (blue) versus Theoretical Limit (orange)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_ConsPortfolioModel_PortfolioConsumerType_11_3.png" src="../../_images/examples_ConsPortfolioModel_PortfolioConsumerType_11_3.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>




</pre></div></div>
</div>
</section>
<section id="3.-A-model-of-%22sticky%22-portfolio-choice">
<h2>3. A model of “sticky” portfolio choice<a class="headerlink" href="#3.-A-model-of-%22sticky%22-portfolio-choice" title="Link to this heading">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make another example type, but this one can only update their risky portfolio</span>
<span class="c1"># share in any particular period with 15% probability.</span>
<span class="n">StickyConsPortfolioDict</span> <span class="o">=</span> <span class="n">ConsPortfolioDict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">StickyConsPortfolioDict</span><span class="p">[</span><span class="s2">&quot;AdjustPrb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.15</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make and solve a discrete portfolio choice consumer type</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s1">&#39;Now solving a portfolio choice problem with &quot;sticky&quot; portfolio shares; this might take a moment...&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">StickyType</span> <span class="o">=</span> <span class="n">PortfolioConsumerType</span><span class="p">(</span><span class="o">**</span><span class="n">StickyConsPortfolioDict</span><span class="p">)</span>
<span class="n">StickyType</span><span class="o">.</span><span class="n">cycles</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">StickyType</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">StickyType</span><span class="o">.</span><span class="n">cFuncAdj</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">StickyType</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">cFuncAdj</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">StickyType</span><span class="o">.</span><span class="n">T_cycle</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">StickyType</span><span class="o">.</span><span class="n">cFuncFxd</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">StickyType</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">cFuncFxd</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">StickyType</span><span class="o">.</span><span class="n">T_cycle</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">StickyType</span><span class="o">.</span><span class="n">ShareFunc</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">StickyType</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">ShareFuncAdj</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">StickyType</span><span class="o">.</span><span class="n">T_cycle</span><span class="p">)</span>
<span class="p">]</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Solving an infinite horizon sticky portfolio choice problem took &quot;</span>
    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>
    <span class="o">+</span> <span class="s2">&quot; seconds.&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Now solving a portfolio choice problem with &#34;sticky&#34; portfolio shares; this might take a moment...
Solving an infinite horizon sticky portfolio choice problem took 9.3389732837677 seconds.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the consumption and risky-share functions</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Consumption function over market resources when the agent can adjust his portfolio:&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plot_funcs</span><span class="p">(</span><span class="n">StickyType</span><span class="o">.</span><span class="n">cFuncAdj</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Consumption function over market resources when the agent can adjust his portfolio:
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_ConsPortfolioModel_PortfolioConsumerType_16_1.png" src="../../_images/examples_ConsPortfolioModel_PortfolioConsumerType_16_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Consumption function over market resources when the agent CAN&#39;T adjust, by current share:&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">21</span><span class="p">):</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">StickyType</span><span class="o">.</span><span class="n">cFuncFxd</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">M</span><span class="p">,</span> <span class="n">s</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">M</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Consumption function over market resources when the agent CAN&#39;T adjust, by current share:
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_ConsPortfolioModel_PortfolioConsumerType_17_1.png" src="../../_images/examples_ConsPortfolioModel_PortfolioConsumerType_17_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Risky asset share function over market resources (when possible to adjust):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optimal (blue) versus Theoretical Limit (orange)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Normalized Market Resources&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Portfolio Share&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">plot_funcs</span><span class="p">(</span>
    <span class="p">[</span><span class="n">StickyType</span><span class="o">.</span><span class="n">ShareFunc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">StickyType</span><span class="o">.</span><span class="n">ShareLimit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">m</span><span class="p">)],</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">200.0</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Risky asset share function over market resources (when possible to adjust):
Optimal (blue) versus Theoretical Limit (orange)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_ConsPortfolioModel_PortfolioConsumerType_18_1.png" src="../../_images/examples_ConsPortfolioModel_PortfolioConsumerType_18_1.png" />
</div>
</div>
<p>Notice the wiggle in the blue line. This reflects the fact that the maximum grid point for which the solution is calculated is <span class="math notranslate nohighlight">\(a=100\)</span> and the (incorrect) assumption built into the model that the portfolio share asymptotes to the frictionless analytical case. An alternative (not yet implemented) would be to calculate the implicit limit defined by the rate of geometric decay among the last grid points and assume that this is the limit.</p>
<p>The difference between the two is likely due to the agent’s inability to adjust their portfolio.</p>
</section>
<section id="4.-Life-cycle-model-of-portfolio-choice">
<h2>4. Life-cycle model of portfolio choice<a class="headerlink" href="#4.-Life-cycle-model-of-portfolio-choice" title="Link to this heading">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">LC_ConsPortfolioDict</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">ConsPortfolioDict</span><span class="p">)</span>
<span class="n">LC_ConsPortfolioDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">time_params</span><span class="p">)</span>
<span class="n">LC_ConsPortfolioDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dist_params</span><span class="p">)</span>
<span class="c1"># Note the income specification overrides the pLvlInitMean from the SCF.</span>
<span class="n">LC_ConsPortfolioDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">income_params</span><span class="p">)</span>
<span class="n">LC_ConsPortfolioDict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;LivPrb&quot;</span><span class="p">:</span> <span class="n">liv_prb</span><span class="p">})</span>

<span class="n">LC_ConsPortfolioDict</span><span class="p">[</span><span class="s2">&quot;RiskyAvg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.08</span><span class="p">]</span> <span class="o">*</span> <span class="n">init_lifecycle</span><span class="p">[</span><span class="s2">&quot;T_cycle&quot;</span><span class="p">]</span>
<span class="n">LC_ConsPortfolioDict</span><span class="p">[</span><span class="s2">&quot;RiskyStd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">,</span> <span class="n">init_lifecycle</span><span class="p">[</span><span class="s2">&quot;T_cycle&quot;</span><span class="p">]),</span>
<span class="p">)</span>
<span class="n">LC_ConsPortfolioDict</span><span class="p">[</span><span class="s2">&quot;RiskyAvgTrue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.08</span>
<span class="n">LC_ConsPortfolioDict</span><span class="p">[</span><span class="s2">&quot;RiskyStdTrue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.20</span>
<span class="n">LC_ConsPortfolioDict</span><span class="p">[</span><span class="s2">&quot;Rfree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.02</span><span class="p">]</span> <span class="o">*</span> <span class="n">init_lifecycle</span><span class="p">[</span><span class="s2">&quot;T_cycle&quot;</span><span class="p">]</span>
<span class="n">AgeVaryingRiskPercType</span> <span class="o">=</span> <span class="n">PortfolioConsumerType</span><span class="p">(</span><span class="o">**</span><span class="n">LC_ConsPortfolioDict</span><span class="p">)</span>
<span class="n">AgeVaryingRiskPercType</span><span class="o">.</span><span class="n">cycles</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solve the agent type with age-varying risk perceptions</span>
<span class="c1"># print(&#39;Now solving a portfolio choice problem with age-varying risk perceptions...&#39;)</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">AgeVaryingRiskPercType</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="n">AgeVaryingRiskPercType</span><span class="o">.</span><span class="n">cFunc</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">AgeVaryingRiskPercType</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">cFuncAdj</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">AgeVaryingRiskPercType</span><span class="o">.</span><span class="n">T_cycle</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">AgeVaryingRiskPercType</span><span class="o">.</span><span class="n">ShareFunc</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">AgeVaryingRiskPercType</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">ShareFuncAdj</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">AgeVaryingRiskPercType</span><span class="o">.</span><span class="n">T_cycle</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Solving a &quot;</span>
    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">AgeVaryingRiskPercType</span><span class="o">.</span><span class="n">T_cycle</span><span class="p">)</span>
    <span class="o">+</span> <span class="s2">&quot; period portfolio choice problem with age-varying risk perceptions took &quot;</span>
    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>
    <span class="o">+</span> <span class="s2">&quot; seconds.&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Solving a 65 period portfolio choice problem with age-varying risk perceptions took 2.5945942401885986 seconds.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the consumption and risky-share functions</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Consumption function over market resources in each lifecycle period:&quot;</span><span class="p">)</span>
<span class="n">plot_funcs</span><span class="p">(</span><span class="n">AgeVaryingRiskPercType</span><span class="o">.</span><span class="n">cFunc</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Risky asset share function over market resources in each lifecycle period:&quot;</span><span class="p">)</span>
<span class="n">plot_funcs</span><span class="p">(</span><span class="n">AgeVaryingRiskPercType</span><span class="o">.</span><span class="n">ShareFunc</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Consumption function over market resources in each lifecycle period:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_ConsPortfolioModel_PortfolioConsumerType_23_1.png" src="../../_images/examples_ConsPortfolioModel_PortfolioConsumerType_23_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Risky asset share function over market resources in each lifecycle period:
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_ConsPortfolioModel_PortfolioConsumerType_23_3.png" src="../../_images/examples_ConsPortfolioModel_PortfolioConsumerType_23_3.png" />
</div>
</div>
</section>
<section id="5.-Portfolio-choice-with-Merton-Samuelson-limiting-shares">
<h2>5. Portfolio choice with Merton-Samuelson limiting shares<a class="headerlink" href="#5.-Portfolio-choice-with-Merton-Samuelson-limiting-shares" title="Link to this heading">#</a></h2>
<p>The code below tests the mathematical limits of the model and features the definition of a Merton-Samuelson type consumer.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a grid of market resources for the plots</span>
<span class="n">mMin</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Minimum ratio of assets to income to plot</span>
<span class="n">mMax</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="mf">1e2</span>  <span class="c1"># Maximum ratio of assets to income to plot</span>
<span class="n">mPts</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># Number of points to plot</span>
<span class="n">plot_point_max</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">aXtraMax</span> <span class="o">=</span> <span class="n">plot_point_max</span> <span class="o">*</span> <span class="mi">10</span>  <span class="c1"># Maximum asset level</span>

<span class="n">eevalgrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mMax</span><span class="p">,</span> <span class="n">mPts</span><span class="p">)</span>  <span class="c1"># range of values of assets for the plot</span>

<span class="c1"># Number of points that will be used to approximate the risky distribution</span>
<span class="n">risky_count_grid</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">200</span><span class="p">]</span>
<span class="c1"># Plot by ages (time periods) at which to plot. We will use the default life-cycle calibration.</span>
<span class="n">ages</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Creating the dictionary for the Merton-Samuelson consumer type</span>
<span class="n">MertonPortfolioDict</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">ConsPortfolioDict</span><span class="p">)</span>
<span class="n">MertonPortfolioDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">time_params</span><span class="p">)</span>
<span class="n">MertonPortfolioDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dist_params</span><span class="p">)</span>
<span class="c1"># Note the income specification overrides the pLvlInitMean from the SCF.</span>
<span class="n">MertonPortfolioDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">income_params</span><span class="p">)</span>
<span class="n">MertonPortfolioDict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;LivPrb&quot;</span><span class="p">:</span> <span class="n">liv_prb</span><span class="p">})</span>
<span class="n">MertonPortfolioDict</span><span class="p">[</span><span class="s2">&quot;Rfree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MertonPortfolioDict</span><span class="p">[</span><span class="s2">&quot;T_cycle&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">[</span><span class="mf">1.02</span><span class="p">]</span>

<span class="n">MertonPortfolioDict</span><span class="p">[</span><span class="s2">&quot;RiskyAvgTrue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.08</span>
<span class="n">MertonPortfolioDict</span><span class="p">[</span><span class="s2">&quot;RiskyStdTrue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.20</span>


<span class="c1"># Create a function to compute the Merton-Samuelson limiting portfolio share.</span>
<span class="k">def</span><span class="w"> </span><span class="nf">RiskyShareMertSamLogNormal</span><span class="p">(</span><span class="n">RiskPrem</span><span class="p">,</span> <span class="n">CRRA</span><span class="p">,</span> <span class="n">RiskyVar</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">RiskPrem</span> <span class="o">/</span> <span class="p">(</span><span class="n">CRRA</span> <span class="o">*</span> <span class="n">RiskyVar</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">rcount</span> <span class="ow">in</span> <span class="n">risky_count_grid</span><span class="p">:</span>
    <span class="c1"># Create a new dictionary and replace the number of points that</span>
    <span class="c1"># approximate the risky return distribution</span>

    <span class="c1"># Create new dictionary copying the default.</span>
    <span class="n">MertonPortfolioDict</span><span class="p">[</span><span class="s2">&quot;RiskyCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rcount</span>

    <span class="c1"># Create and solve agent</span>
    <span class="n">agent</span> <span class="o">=</span> <span class="n">PortfolioConsumerType</span><span class="p">(</span><span class="o">**</span><span class="n">MertonPortfolioDict</span><span class="p">)</span>
    <span class="n">agent</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>

    <span class="c1"># Compute the analytical Merton-Samuelson limiting portfolio share</span>
    <span class="n">RiskyVar</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">RiskyStd</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">RiskPrem</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">RiskyAvg</span> <span class="o">-</span> <span class="n">agent</span><span class="o">.</span><span class="n">Rfree</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">MS_limit</span> <span class="o">=</span> <span class="n">RiskyShareMertSamLogNormal</span><span class="p">(</span><span class="n">RiskPrem</span><span class="p">,</span> <span class="n">agent</span><span class="o">.</span><span class="n">CRRA</span><span class="p">,</span> <span class="n">RiskyVar</span><span class="p">)</span>

    <span class="c1"># Now compute the limiting share numerically, using the approximated</span>
    <span class="c1"># distribution</span>
    <span class="n">agent</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;ShareLimit&quot;</span><span class="p">)</span>
    <span class="n">NU_limit</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">ShareLimit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ages</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">eevalgrid</span><span class="p">,</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">ShareFuncAdj</span><span class="p">(</span><span class="n">eevalgrid</span><span class="p">),</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;t = </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span>
        <span class="n">NU_limit</span><span class="p">,</span>
        <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
        <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Exact limit as $m</span><span class="se">\\</span><span class="s2">rightarrow </span><span class="se">\\</span><span class="s2">infty$.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span>
        <span class="n">MS_limit</span><span class="p">,</span>
        <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
        <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;M&amp;S Limit without returns discretization.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">eevalgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">eevalgrid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Risky Portfolio Share by Age</span><span class="se">\n</span><span class="s2"> Risky distribution with </span><span class="si">{</span><span class="n">rcount</span><span class="si">}</span><span class="s2"> equiprobable points&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Wealth (m)&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.18362634887 1.03 5.0 1.08
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_ConsPortfolioModel_PortfolioConsumerType_27_1.png" src="../../_images/examples_ConsPortfolioModel_PortfolioConsumerType_27_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.18362634887 1.03 5.0 1.08
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_ConsPortfolioModel_PortfolioConsumerType_27_3.png" src="../../_images/examples_ConsPortfolioModel_PortfolioConsumerType_27_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.18362634887 1.03 5.0 1.08
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_ConsPortfolioModel_PortfolioConsumerType_27_5.png" src="../../_images/examples_ConsPortfolioModel_PortfolioConsumerType_27_5.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../ConsAggShockModel/AggShockConsumerType.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Example ConsAggShockModel</p>
      </div>
    </a>
    <a class="right-next"
       href="RiskyAssetConsumerType.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Example Implementations of <code class="docutils literal notranslate"><span class="pre">HARK.ConsumptionSaving.ConsRiskyAssetModel</span></code></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#1.-The-baseline-model-of-optimal-portfolio-choice">1. The baseline model of optimal portfolio choice</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#2.-Discrete-portfolio-choice">2. Discrete portfolio choice</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#3.-A-model-of-%22sticky%22-portfolio-choice">3. A model of “sticky” portfolio choice</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#4.-Life-cycle-model-of-portfolio-choice">4. Life-cycle model of portfolio choice</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#5.-Portfolio-choice-with-Merton-Samuelson-limiting-shares">5. Portfolio choice with Merton-Samuelson limiting shares</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, Econ-ARK team.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>