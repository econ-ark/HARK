
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Using Transition Matrix Methods under IndShockConsumerType &#8212; HARK latest documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="../../_static/override-nbsphinx-gallery.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=91d07486"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/SequenceSpaceJacobians/Transition_Matrix_Example';</script>
    <link rel="canonical" href="https://docs.econ-ark.org/examples/SequenceSpaceJacobians/Transition_Matrix_Example.html" />
    <link rel="icon" href="../../_static/econ-ark-logo.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Computing Heterogenous Agent Sequence Space Jacobians in HARK" href="Jacobian_Example.html" />
    <link rel="prev" title="A Life Cycle Model: The Distribution of Assets By Age" href="../LifecycleModel/LifecycleModel.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="latest" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/econ-ark-logo.png" class="logo__image only-light" alt="HARK latest documentation - Home"/>
    <img src="../../_static/econ-ark-logo.png" class="logo__image only-dark pst-js-only" alt="HARK latest documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../docs/guides/index.html">
    Guides
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../../docs/overview/index.html">
    Overview & Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../docs/reference/index.html">
    Reference
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/Econ-ARK/HARK" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/econ_ark" title="Twitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/econ-ark/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-box fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://econ-ark.org" title="Econ-ARK" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../_static/econ-ark-logo.png" class="icon-link-image" alt="Econ-ARK"/></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../docs/guides/index.html">
    Guides
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../../docs/overview/index.html">
    Overview & Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../docs/reference/index.html">
    Reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/Econ-ARK/HARK" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/econ_ark" title="Twitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/econ-ark/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-box fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://econ-ark.org" title="Econ-ARK" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../_static/econ-ark-logo.png" class="icon-link-image" alt="Econ-ARK"/></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction to HARK</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../docs/overview/introduction.html">Introduction to HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/overview/ARKitecture.html">ARKitecture of Econ-ARK</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Learning About HARK</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Gentle-Intro/Gentle-Intro-To-HARK.html">A Gentle Introduction to HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Gentle-Intro/Simulation-Intro.html">Simulating Microeconomic Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Gentle-Intro/Cycles-Intro.html">The Nature of Time in HARK’s Microeconomic Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Gentle-Intro/Constructors-Intro.html">Constructed Attributes and Model Defaults</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Gentle-Intro/Advanced-Intro.html">Advanced and Uncommon HARK Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Gentle-Intro/Methods-Intro.html">Numeric Methods Commonly Used in HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Gentle-Intro/Model-List.html">Directory of Consumption-Saving Models in HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Gentle-Intro/AgentType-Intro.html">Elements of an AgentType Subclass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Gentle-Intro/Market-Intro.html">Solving for “Macroeconomic” Equilibrium in HARK: the <code class="docutils literal notranslate"><span class="pre">Market</span></code> class</a></li>
<li class="toctree-l1"><a class="reference internal" href="SSJ_explanation.html">The Sequence Space Jacobian (SSJ) method</a></li>

<li class="toctree-l1"><a class="reference internal" href="SSJ-tutorial.html">Making Heterogeneous Agent Sequence Space Jacobian Matrices in HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Journeys/Journey-PhD.html">Journey: Economics PhD Student</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">HARK Models</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../ConsIndShockModel/PerfForesightConsumerType.html">Perfect foresight consumption-saving</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsIndShockModel/IndShockConsumerType.html">Consumption-Saving model with Idiosyncratic Income Shocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsIndShockModel/KinkedRconsumerType.html">Consumption-Saving model with Idiosyncratic Income Shocks and Different Interest Rates on Borrowing and Saving</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsMarkovModel/MarkovConsumerType.html">Additional parameter value to solve an instance of MarkovConsumerType</a></li>





<li class="toctree-l1"><a class="reference internal" href="../ConsGenIncProcessModel/GenIncProcessConsumerType.html">Permanent versus Persistent Income Shocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsAggShockModel/AggShockConsumerType.html">Example ConsAggShockModel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsPortfolioModel/PortfolioConsumerType.html">Portfolio Models in HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsPortfolioModel/RiskyAssetConsumerType.html">Example Implementations of <code class="docutils literal notranslate"><span class="pre">HARK.ConsumptionSaving.ConsRiskyAssetModel</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsPortfolioModel/SequentialPortfolioConsumerType.html">Consumption-Saving with Portfolio Allocation: Sequential Solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsLaborModel/LaborIntMargConsumerType.html">Consumption-Saving with Intensive Margin Labor Supply Choice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsPrefShockModel/PrefShockConsumerType.html">Multiplicative Shocks to Utility</a></li>




<li class="toctree-l1"><a class="reference internal" href="../ConsHealthModel/BasicHealthConsumerType.html">Basic Health Investment in a Consumption-Saving Model</a></li>

<li class="toctree-l1"><a class="reference internal" href="../ConsMedModel/MedShockConsumerType.html">Medical Care as a Consumption Good with Stochastic Demand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsMedModel/MedExtMargConsumerType.html">Consumption-Saving with Medical Care Choice on the Extensive Margin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsRepAgentModel/RepAgentConsumerType.html">Representative Agent Consumption-Saving Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ConsRiskyContribModel/RiskyContribConsumerType.html">“Risky Contribution” Model (UNKNOWN / UNEXPLAINED)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../LifecycleModel/LifecycleModel.html">A Life Cycle Model: The Distribution of Assets By Age</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Using Transition Matrix Methods under IndShockConsumerType</a></li>
<li class="toctree-l1"><a class="reference internal" href="Jacobian_Example.html">Computing Heterogenous Agent Sequence Space Jacobians in HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="KS-HARK-presentation.html">Solving Krusell Smith Model with HARK and SSJ</a></li>


<li class="toctree-l1"><a class="reference internal" href="HANKFiscal_example.html">HARK and the Sequence Space Jacobian (SSJ) Method</a></li>





</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Extras</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../docs/CHANGELOG.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/license.html">License</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../docs/overview/index.html" class="nav-link">Overview</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Using Transition Matrix Methods under IndShockConsumerType</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="admonition note">
  This page was generated from
  <a class="reference external" href="https://github.com/econ-ark/HARK/tree/master/examples/SequenceSpaceJacobians/Transition_Matrix_Example.ipynb">examples/SequenceSpaceJacobians/Transition_Matrix_Example.ipynb</a>.
  <br />
  Interactive online version:
  <span style="white-space: nowrap;"><a href="https://mybinder.org/v2/gh/econ-ark/HARK/master?filepath=examples/SequenceSpaceJacobians/Transition_Matrix_Example.ipynb"><img alt="Binder badge" src="https://mybinder.org/badge_logo.svg" style="vertical-align:text-bottom"></a>.</span>
  <a href="Transition_Matrix_Example.ipynb" class="reference download internal" download>Download notebook</a>.
</div><section id="Using-Transition-Matrix-Methods-under-IndShockConsumerType">
<h1>Using Transition Matrix Methods under IndShockConsumerType<a class="headerlink" href="#Using-Transition-Matrix-Methods-under-IndShockConsumerType" title="Link to this heading">#</a></h1>
<p>By William Du (<a class="reference external" href="mailto:wdu9&#37;&#52;&#48;jhu&#46;edu">wdu9<span>&#64;</span>jhu<span>&#46;</span>edu</a>)</p>
<p>This Jupyter Notebook demonstrates how to non-stochastically simulate an economy with transition matrices with functions under the NewKeynesianConsumerType.</p>
<p>The three key functions to non stochastically simulate are:</p>
<section id="define_distribution_grid">
<h2>define_distribution_grid<a class="headerlink" href="#define_distribution_grid" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>computes the grid of normalized market resources and the grid permanent income storing each as attributes of self.</p></li>
</ul>
<p>calc_transition_matrix</p>
<ul class="simple">
<li><p>computes transition matrix (matrices), a grid of consumption policies, and a grid asset policies stored as attributes of self. If the problem has a finite horizon, this function stores lists of transition matrices, consumption policies and asset policies grid for each period as attributes of self.</p></li>
</ul>
</section>
<section id="calc_ergodic_dist">
<h2>calc_ergodic_dist<a class="headerlink" href="#calc_ergodic_dist" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>computes the ergodic distribution stored as attributes. The distribution is stored as a vector (self.vec_erg_dstn) and as a grid (self.erg_dstn)</p></li>
</ul>
<section id="Set-up-Computational-Environment">
<h3>Set up Computational Environment<a class="headerlink" href="#Set-up-Computational-Environment" title="Link to this heading">#</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">copy</span><span class="w"> </span><span class="kn">import</span> <span class="n">deepcopy</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">HARK.ConsumptionSaving.ConsNewKeynesianModel</span><span class="w"> </span><span class="kn">import</span> <span class="n">NewKeynesianConsumerType</span>
</pre></div>
</div>
</div>
</section>
<section id="Set-up-the-Dictionary">
<h3>Set up the Dictionary<a class="headerlink" href="#Set-up-the-Dictionary" title="Link to this heading">#</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># Parameters shared with the perfect foresight model</span>
    <span class="s2">&quot;CRRA&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># Coefficient of relative risk aversion</span>
    <span class="s2">&quot;Rfree&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.04</span><span class="o">**</span><span class="mf">0.25</span><span class="p">],</span>  <span class="c1"># Interest factor on assets</span>
    <span class="s2">&quot;DiscFac&quot;</span><span class="p">:</span> <span class="mf">0.975</span><span class="p">,</span>  <span class="c1"># Intertemporal discount factor</span>
    <span class="s2">&quot;LivPrb&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.99375</span><span class="p">],</span>  <span class="c1"># Survival probability</span>
    <span class="s2">&quot;PermGroFac&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.00</span><span class="p">],</span>  <span class="c1"># Permanent income growth factor</span>
    <span class="c1"># Parameters that specify the income distribution over the lifecycle</span>
    <span class="s2">&quot;PermShkStd&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.06</span><span class="p">],</span>  <span class="c1"># Standard deviation of log permanent shocks to income</span>
    <span class="s2">&quot;PermShkCount&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>  <span class="c1"># Number of points in discrete approximation to permanent income shocks</span>
    <span class="s2">&quot;TranShkStd&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">],</span>  <span class="c1"># Standard deviation of log transitory shocks to income</span>
    <span class="s2">&quot;TranShkCount&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>  <span class="c1"># Number of points in discrete approximation to transitory income shocks</span>
    <span class="s2">&quot;UnempPrb&quot;</span><span class="p">:</span> <span class="mf">0.00</span><span class="p">,</span>  <span class="c1"># Probability of unemployment while working</span>
    <span class="s2">&quot;IncUnemp&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Unemployment benefits replacement rate</span>
    <span class="s2">&quot;UnempPrbRet&quot;</span><span class="p">:</span> <span class="mf">0.0000</span><span class="p">,</span>  <span class="c1"># Probability of &quot;unemployment&quot; while retired</span>
    <span class="s2">&quot;IncUnempRet&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># &quot;Unemployment&quot; benefits when retired</span>
    <span class="s2">&quot;T_retire&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># Period of retirement (0 --&gt; no retirement)</span>
    <span class="c1"># A few other parameters</span>
    <span class="s2">&quot;BoroCnstArt&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Artificial borrowing constraint; imposed minimum level of end-of period assets</span>
    <span class="s2">&quot;T_cycle&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Number of periods in the cycle for this agent type</span>
    <span class="c1"># Parameters only used in simulation</span>
    <span class="s2">&quot;AgentCount&quot;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span>  <span class="c1"># Number of agents of this type</span>
    <span class="s2">&quot;T_sim&quot;</span><span class="p">:</span> <span class="mi">1100</span><span class="p">,</span>  <span class="c1"># Number of periods to simulate</span>
    <span class="s2">&quot;aNrmInitMean&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">0.000001</span><span class="p">),</span>  <span class="c1"># Mean of log initial assets ,</span>
    <span class="c1"># The value of np.log(0.0) causes the code to ensure newborns have have exactly 1.0 in market resources.</span>
    <span class="c1"># Mean of log initial assets</span>
    <span class="s2">&quot;aNrmInitStd&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Standard deviation of log initial assets</span>
    <span class="s2">&quot;pLvlInitMean&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Mean of log initial permanent income</span>
    <span class="s2">&quot;pLvlInitStd&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Standard deviation of log initial permanent income</span>
    <span class="s2">&quot;PermGroFacAgg&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># Aggregate permanent income growth factor</span>
    <span class="s2">&quot;T_age&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Age after which simulated agents are automatically killed</span>
    <span class="c1"># Parameters for constructing the &quot;assets above minimum&quot; grid</span>
    <span class="s2">&quot;aXtraMin&quot;</span><span class="p">:</span> <span class="mf">0.0001</span><span class="p">,</span>  <span class="c1"># Minimum end-of-period &quot;assets above minimum&quot; value</span>
    <span class="s2">&quot;aXtraMax&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>  <span class="c1"># Maximum end-of-period &quot;assets above minimum&quot; value</span>
    <span class="s2">&quot;aXtraCount&quot;</span><span class="p">:</span> <span class="mi">130</span><span class="p">,</span>  <span class="c1"># Number of points in the base grid of &quot;assets above minimum&quot;</span>
    <span class="s2">&quot;aXtraNestFac&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>  <span class="c1"># Exponential nesting factor when constructing &quot;assets above minimum&quot; grid</span>
    <span class="s2">&quot;aXtraExtra&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Additional values to add to aXtraGrid</span>
    <span class="c1"># Parameters for Transition Matrix Simulation</span>
    <span class="s2">&quot;mCount&quot;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>
    <span class="s2">&quot;mFac&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;mMin&quot;</span><span class="p">:</span> <span class="mf">1e-4</span><span class="p">,</span>
    <span class="s2">&quot;mMax&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</section>
<section id="Create-an-Instance-of-IndShockConsumerType-and-Solve">
<h3>Create an Instance of IndShockConsumerType and Solve<a class="headerlink" href="#Create-an-Instance-of-IndShockConsumerType-and-Solve" title="Link to this heading">#</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">example1</span> <span class="o">=</span> <span class="n">NewKeynesianConsumerType</span><span class="p">(</span><span class="o">**</span><span class="n">Dict</span><span class="p">)</span>
<span class="n">example1</span><span class="o">.</span><span class="n">cycles</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">example1</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Simulation:-Transition-Matrix-vs-Monte-Carlo">
<h3>Simulation: Transition Matrix vs Monte Carlo<a class="headerlink" href="#Simulation:-Transition-Matrix-vs-Monte-Carlo" title="Link to this heading">#</a></h3>
<p>This section compares monte carlo methods against the transition matrix approach in computing aggregate consumption and aggregate assets.</p>
</section>
<section id="Method-1:-Monte-Carlo">
<h3>Method 1: Monte Carlo<a class="headerlink" href="#Method-1:-Monte-Carlo" title="Link to this heading">#</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulation Parameters</span>

<span class="c1"># Simulate</span>
<span class="n">example1</span><span class="o">.</span><span class="n">track_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;aLvl&quot;</span><span class="p">]</span>  <span class="c1"># Track level of assets</span>
<span class="n">example1</span><span class="o">.</span><span class="n">initialize_sim</span><span class="p">()</span>
<span class="n">example1</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>  <span class="c1"># Simulate with Monte Carlo</span>

<span class="c1"># Compute Aggregate Consumption and Aggregate Assets</span>
<span class="n">Monte_Carlo_Consumption</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
    <span class="p">(</span><span class="n">example1</span><span class="o">.</span><span class="n">state_now</span><span class="p">[</span><span class="s2">&quot;mNrm&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">example1</span><span class="o">.</span><span class="n">state_now</span><span class="p">[</span><span class="s2">&quot;aNrm&quot;</span><span class="p">])</span>
    <span class="o">*</span> <span class="n">example1</span><span class="o">.</span><span class="n">state_now</span><span class="p">[</span><span class="s2">&quot;pLvl&quot;</span><span class="p">],</span>
<span class="p">)</span>  <span class="c1"># Aggregate Consumption</span>
<span class="n">Monte_Carlo_Assets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
    <span class="n">example1</span><span class="o">.</span><span class="n">state_now</span><span class="p">[</span><span class="s2">&quot;aNrm&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">example1</span><span class="o">.</span><span class="n">state_now</span><span class="p">[</span><span class="s2">&quot;pLvl&quot;</span><span class="p">],</span>
<span class="p">)</span>  <span class="c1"># Aggregate Assets</span>
</pre></div>
</div>
</div>
</section>
<section id="Method-2:-Transition-Matrices">
<h3>Method 2: Transition Matrices<a class="headerlink" href="#Method-2:-Transition-Matrices" title="Link to this heading">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">example1</span><span class="o">.</span><span class="n">define_distribution_grid</span><span class="p">(</span><span class="n">num_pointsP</span><span class="o">=</span><span class="mi">110</span><span class="p">,</span> <span class="n">timestonest</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">example1</span><span class="o">.</span><span class="n">dist_pGrid</span>  <span class="c1"># Grid of permanent income levels</span>

<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">example1</span><span class="o">.</span><span class="n">calc_transition_matrix</span><span class="p">()</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">example1</span><span class="o">.</span><span class="n">cPol_Grid</span>  <span class="c1"># Normalized Consumption Policy Grid</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">example1</span><span class="o">.</span><span class="n">aPol_Grid</span>  <span class="c1"># Normalized Asset Policy Grid</span>

<span class="n">example1</span><span class="o">.</span><span class="n">calc_ergodic_dist</span><span class="p">()</span>
<span class="n">vecDstn</span> <span class="o">=</span> <span class="n">example1</span><span class="o">.</span><span class="n">vec_erg_dstn</span>  <span class="c1"># Distribution of market resources and permanent income as a vector (m*p)x1 vector where</span>
<span class="c1"># m is the number of market resource gridpoints and p is the number of permanent income gridpoints</span>
<span class="n">erg_dstn</span> <span class="o">=</span> <span class="n">example1</span><span class="o">.</span><span class="n">erg_dstn</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Seconds to calculate both the transition matrix and the steady state distribution&quot;</span><span class="p">,</span>
    <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Seconds to calculate both the transition matrix and the steady state distribution 42.87453579902649
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute Aggregate Consumption and Aggregate Assets</span>
<span class="n">gridc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)))</span>
<span class="n">grida</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">asset</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)):</span>
    <span class="n">gridc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span>  <span class="c1"># unnormalized Consumption policy grid</span>
    <span class="n">grida</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">asset</span>  <span class="c1"># unnormalized Asset policy grid</span>

<span class="n">AggC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">gridc</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">vecDstn</span><span class="p">)</span>  <span class="c1"># Aggregate Consumption</span>
<span class="n">AggA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">grida</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">vecDstn</span><span class="p">)</span>  <span class="c1"># Aggregate Assets</span>
</pre></div>
</div>
</div>
<section id="Comparing-Steady-State-Outputs-of-Both-Methods">
<h4>Comparing Steady State Outputs of Both Methods<a class="headerlink" href="#Comparing-Steady-State-Outputs-of-Both-Methods" title="Link to this heading">#</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TranMatrix Assets = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">AggA</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Simulated Assets = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Monte_Carlo_Assets</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TranMatrix Consumption = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">AggC</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Simulated Consumption = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Monte_Carlo_Consumption</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
TranMatrix Assets = [0.41854438]
Simulated Assets = 0.41176409927674545
TranMatrix Consumption = [1.00153889]
Simulated Consumption = 1.0010436523456787
</pre></div></div>
</div>
</section>
<section id="Comparing-Simulated-Path-of-Aggregate-Assets">
<h4>Comparing Simulated Path of Aggregate Assets<a class="headerlink" href="#Comparing-Simulated-Path-of-Aggregate-Assets" title="Link to this heading">#</a></h4>
<p>The following code plots the path of aggregate assets simulate from both Monte Carlo methods and transition matrix methods.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aLvls</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Time series of aggregate assets</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">example1</span><span class="o">.</span><span class="n">T_sim</span><span class="p">):</span>
    <span class="n">aLvls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">example1</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">&quot;aLvl&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span>
    <span class="p">)</span>  <span class="c1"># compute mean of aggregate assets across all agents for each period of the simulation</span>
<span class="n">aLvls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aLvls</span><span class="p">)</span>

<span class="n">aLvl_tran_mat</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dstn</span> <span class="o">=</span> <span class="n">vecDstn</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">example1</span><span class="o">.</span><span class="n">T_sim</span> <span class="o">-</span> <span class="mi">400</span><span class="p">):</span>
    <span class="n">A_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">grida</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">dstn</span><span class="p">)</span>

    <span class="n">aLvl_tran_mat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">A_val</span><span class="p">)</span>
    <span class="n">dstn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">example1</span><span class="o">.</span><span class="n">tran_matrix</span><span class="p">,</span> <span class="n">dstn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">aLvls</span><span class="p">[</span><span class="mi">400</span><span class="p">:],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Monte Carlo&quot;</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># Plot time series path of aggregate assets using Monte Carlo simulation methods</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">aLvl_tran_mat</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition matrix&quot;</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># Plot time series path of aggregate assets computed using transition matrix</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">0.37</span><span class="p">,</span> <span class="mf">0.46</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_SequenceSpaceJacobians_Transition_Matrix_Example_19_0.png" src="../../_images/examples_SequenceSpaceJacobians_Transition_Matrix_Example_19_0.png" />
</div>
</div>
</section>
<section id="Precision-vs-Accuracy">
<h4>Precision vs Accuracy<a class="headerlink" href="#Precision-vs-Accuracy" title="Link to this heading">#</a></h4>
<p>Notice the mean level of aggregate assets differ between both simulation methods. The transition matrix plots a perfectly horizontal line as the initial distribution of agents across market resources and permanent is the unit eigenvector of the steady state transition matrix. Thus, as we take the produce of the transition matrix and the initial distribution, the new distribution does not change, implying the level of aggregate assets does not change. In contrast, the time series path simulated
from Monte Carlo methods vacillates. This is because Monte Carlo methods are truly stochastic, randomly drawing shocks from a income distribution, while transition matrix methods are non-stochastic, the shock values are preset and the grid over market resources have is fixed. This contrast highlights the limitation of both methods, the monte carlo leads to a more accurate, yet less precise, level of aggregate assets while the transition matrix leads in precision but requires a larger number of
gridpoints to be accurate.</p>
</section>
</section>
<section id="Distribution-of-Normalized-Market-Resources">
<h3>Distribution of Normalized Market Resources<a class="headerlink" href="#Distribution-of-Normalized-Market-Resources" title="Link to this heading">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_pts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">example1</span><span class="o">.</span><span class="n">dist_mGrid</span><span class="p">)</span>
<span class="n">mdstn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_pts</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_pts</span><span class="p">):</span>
    <span class="n">mdstn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
        <span class="n">example1</span><span class="o">.</span><span class="n">erg_dstn</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
    <span class="p">)</span>  <span class="c1"># distribution of normalized market resources</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">example1</span><span class="o">.</span><span class="n">state_now</span><span class="p">[</span><span class="s2">&quot;mNrm&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">example1</span><span class="o">.</span><span class="n">dist_mGrid</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">example1</span><span class="o">.</span><span class="n">state_now</span><span class="p">[</span><span class="s2">&quot;mNrm&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">example1</span><span class="o">.</span><span class="n">dist_mGrid</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>  <span class="c1"># Form Monte Carlo wealth data and put into histogram/bins</span>


<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">example1</span><span class="o">.</span><span class="n">dist_mGrid</span><span class="p">[:</span> <span class="n">num_pts</span> <span class="o">-</span> <span class="mi">20</span><span class="p">],</span>
    <span class="n">mdstn</span><span class="p">[:</span> <span class="n">num_pts</span> <span class="o">-</span> <span class="mi">20</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition Matrix&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># distribution using transition matrix method</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">example1</span><span class="o">.</span><span class="n">dist_mGrid</span><span class="p">[:</span> <span class="n">num_pts</span> <span class="o">-</span> <span class="mi">20</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">h</span><span class="p">[:</span> <span class="n">num_pts</span> <span class="o">-</span> <span class="mi">20</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Monte Carlo&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># distribution using Monte Carlo</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_SequenceSpaceJacobians_Transition_Matrix_Example_22_0.png" src="../../_images/examples_SequenceSpaceJacobians_Transition_Matrix_Example_22_0.png" />
</div>
</div>
</section>
<section id="Distributions-of-Permanent-Income">
<h3>Distributions of Permanent Income<a class="headerlink" href="#Distributions-of-Permanent-Income" title="Link to this heading">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dstn</span> <span class="o">=</span> <span class="n">example1</span><span class="o">.</span><span class="n">erg_dstn</span>

<span class="n">pdstn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dstn</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pdstn</span><span class="p">)):</span>
    <span class="n">pdstn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dstn</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">example1</span><span class="o">.</span><span class="n">state_now</span><span class="p">[</span><span class="s2">&quot;pLvl&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">example1</span><span class="o">.</span><span class="n">dist_pGrid</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">example1</span><span class="o">.</span><span class="n">state_now</span><span class="p">[</span><span class="s2">&quot;pLvl&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">example1</span><span class="o">.</span><span class="n">dist_pGrid</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>  <span class="c1"># Form Monte Carlo wealth data and put into histogram/bins</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">example1</span><span class="o">.</span><span class="n">dist_pGrid</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">h</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Monte Carlo&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># distribution using Monte Carlo</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">example1</span><span class="o">.</span><span class="n">dist_pGrid</span><span class="p">,</span> <span class="n">pdstn</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;transition matrix&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Probability&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Permanent Income&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Distribution of Permanent Income&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_SequenceSpaceJacobians_Transition_Matrix_Example_24_0.png" src="../../_images/examples_SequenceSpaceJacobians_Transition_Matrix_Example_24_0.png" />
</div>
</div>
</section>
<section id="Distribution-of-Wealth">
<h3>Distribution of Wealth<a class="headerlink" href="#Distribution-of-Wealth" title="Link to this heading">#</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute all possible mLvl values given permanent income grid and normalized market resources grid</span>

<span class="n">mLvl_vals</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">example1</span><span class="o">.</span><span class="n">dist_mGrid</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">example1</span><span class="o">.</span><span class="n">dist_pGrid</span><span class="p">:</span>
        <span class="n">mLvl_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span>

<span class="n">mLvl_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mLvl_vals</span><span class="p">)</span>


<span class="n">aLvl_vals</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">example1</span><span class="o">.</span><span class="n">aPol_Grid</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">example1</span><span class="o">.</span><span class="n">dist_pGrid</span><span class="p">:</span>
        <span class="n">aLvl_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span>

<span class="n">aLvl_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aLvl_vals</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">jump_to_grid_fast</span><span class="p">(</span><span class="n">m_vals</span><span class="p">,</span> <span class="n">probs</span><span class="p">,</span> <span class="n">Dist_mGrid</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Distributes values onto a predefined grid, maintaining the means.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m_vals: np.array</span>
<span class="sd">            Market resource values</span>

<span class="sd">    probs: np.array</span>
<span class="sd">            Shock probabilities associated with combinations of m_vals.</span>
<span class="sd">            Can be thought of as the probability mass function  of (m_vals).</span>

<span class="sd">    dist_mGrid : np.array</span>
<span class="sd">            Grid over normalized market resources</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    probGrid.flatten(): np.array</span>
<span class="sd">             Probabilities of each gridpoint on the combined grid of market resources</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">probGrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Dist_mGrid</span><span class="p">))</span>
    <span class="n">mIndex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">m_vals</span><span class="p">,</span> <span class="n">Dist_mGrid</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">mIndex</span><span class="p">[</span><span class="n">m_vals</span> <span class="o">&lt;=</span> <span class="n">Dist_mGrid</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">mIndex</span><span class="p">[</span><span class="n">m_vals</span> <span class="o">&gt;=</span> <span class="n">Dist_mGrid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Dist_mGrid</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m_vals</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">mIndex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">mlowerIndex</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">mupperIndex</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">mlowerWeight</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">mupperWeight</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">elif</span> <span class="n">mIndex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">Dist_mGrid</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">mlowerIndex</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">mupperIndex</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">mlowerWeight</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">mupperWeight</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mlowerIndex</span> <span class="o">=</span> <span class="n">mIndex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">mupperIndex</span> <span class="o">=</span> <span class="n">mIndex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">mlowerWeight</span> <span class="o">=</span> <span class="p">(</span><span class="n">Dist_mGrid</span><span class="p">[</span><span class="n">mupperIndex</span><span class="p">]</span> <span class="o">-</span> <span class="n">m_vals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span>
                <span class="n">Dist_mGrid</span><span class="p">[</span><span class="n">mupperIndex</span><span class="p">]</span> <span class="o">-</span> <span class="n">Dist_mGrid</span><span class="p">[</span><span class="n">mlowerIndex</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">mupperWeight</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">mlowerWeight</span>

        <span class="n">probGrid</span><span class="p">[</span><span class="n">mlowerIndex</span><span class="p">]</span> <span class="o">+=</span> <span class="n">probs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">mlowerWeight</span>
        <span class="n">probGrid</span><span class="p">[</span><span class="n">mupperIndex</span><span class="p">]</span> <span class="o">+=</span> <span class="n">probs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">mupperWeight</span>

    <span class="k">return</span> <span class="n">probGrid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mLvl</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">example1</span><span class="o">.</span><span class="n">state_now</span><span class="p">[</span><span class="s2">&quot;mNrm&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">example1</span><span class="o">.</span><span class="n">state_now</span><span class="p">[</span><span class="s2">&quot;pLvl&quot;</span><span class="p">]</span>
<span class="p">)</span>  <span class="c1"># market resources from Monte Carlo Simulations</span>
<span class="n">pmf</span> <span class="o">=</span> <span class="n">jump_to_grid_fast</span><span class="p">(</span>
    <span class="n">mLvl_vals</span><span class="p">,</span>
    <span class="n">vecDstn</span><span class="p">,</span>
    <span class="n">example1</span><span class="o">.</span><span class="n">dist_mGrid</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># probabilities/distribution from transition matrix methods</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">mLvl</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">example1</span><span class="o">.</span><span class="n">dist_mGrid</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">mLvl</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">example1</span><span class="o">.</span><span class="n">dist_mGrid</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>  <span class="c1"># Form Monte Carlo wealth data and put into histogram/bins</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">example1</span><span class="o">.</span><span class="n">dist_mGrid</span><span class="p">[:</span> <span class="n">num_pts</span> <span class="o">-</span> <span class="mi">20</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">h</span><span class="p">[:</span> <span class="n">num_pts</span> <span class="o">-</span> <span class="mi">20</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Monte Carlo&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># distribution using Monte Carlo</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">example1</span><span class="o">.</span><span class="n">dist_mGrid</span><span class="p">[:</span> <span class="n">num_pts</span> <span class="o">-</span> <span class="mi">20</span><span class="p">],</span>
    <span class="n">pmf</span><span class="p">[:</span> <span class="n">num_pts</span> <span class="o">-</span> <span class="mi">20</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;transition Matrix&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Market Resources (Levels)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Distribution of Market Resources&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
D:\Temp\ipykernel_18916\3173883360.py:46: DeprecationWarning: Conversion of an array with ndim &gt; 0 to a scalar is deprecated, and will error in future. Ensure you extract a single element from your array before performing this operation. (Deprecated NumPy 1.25.)
  probGrid[mlowerIndex] += probs[i] * mlowerWeight
D:\Temp\ipykernel_18916\3173883360.py:47: DeprecationWarning: Conversion of an array with ndim &gt; 0 to a scalar is deprecated, and will error in future. Ensure you extract a single element from your array before performing this operation. (Deprecated NumPy 1.25.)
  probGrid[mupperIndex] += probs[i] * mupperWeight
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_SequenceSpaceJacobians_Transition_Matrix_Example_28_1.png" src="../../_images/examples_SequenceSpaceJacobians_Transition_Matrix_Example_28_1.png" />
</div>
</div>
</section>
<section id="Distribution-of-Liquid-Assets">
<h3>Distribution of Liquid Assets<a class="headerlink" href="#Distribution-of-Liquid-Assets" title="Link to this heading">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">asset_Lvl</span> <span class="o">=</span> <span class="n">example1</span><span class="o">.</span><span class="n">state_now</span><span class="p">[</span><span class="s2">&quot;aLvl&quot;</span><span class="p">]</span>  <span class="c1"># market resources from Monte Carlo Simulations</span>
<span class="n">pmf</span> <span class="o">=</span> <span class="n">jump_to_grid_fast</span><span class="p">(</span>
    <span class="n">aLvl_vals</span><span class="p">,</span>
    <span class="n">vecDstn</span><span class="p">,</span>
    <span class="n">example1</span><span class="o">.</span><span class="n">aPol_Grid</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># probabilities/distribution from transition matrix methods</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">asset_Lvl</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">example1</span><span class="o">.</span><span class="n">aPol_Grid</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">asset_Lvl</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">example1</span><span class="o">.</span><span class="n">aPol_Grid</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>  <span class="c1"># Form Monte Carlo wealth data and put into histogram/bins</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">example1</span><span class="o">.</span><span class="n">aPol_Grid</span><span class="p">[:</span> <span class="n">num_pts</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">h</span><span class="p">[:</span> <span class="n">num_pts</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Monte Carlo&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># distribution using Monte Carlo</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">example1</span><span class="o">.</span><span class="n">aPol_Grid</span><span class="p">[:</span> <span class="n">num_pts</span> <span class="o">-</span> <span class="mi">10</span><span class="p">],</span>
    <span class="n">pmf</span><span class="p">[:</span> <span class="n">num_pts</span> <span class="o">-</span> <span class="mi">10</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;transition Matrix&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Liquid Assets (Levels)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Distribution of Liquids Assets&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
D:\Temp\ipykernel_18916\3173883360.py:46: DeprecationWarning: Conversion of an array with ndim &gt; 0 to a scalar is deprecated, and will error in future. Ensure you extract a single element from your array before performing this operation. (Deprecated NumPy 1.25.)
  probGrid[mlowerIndex] += probs[i] * mlowerWeight
D:\Temp\ipykernel_18916\3173883360.py:47: DeprecationWarning: Conversion of an array with ndim &gt; 0 to a scalar is deprecated, and will error in future. Ensure you extract a single element from your array before performing this operation. (Deprecated NumPy 1.25.)
  probGrid[mupperIndex] += probs[i] * mupperWeight
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_SequenceSpaceJacobians_Transition_Matrix_Example_30_1.png" src="../../_images/examples_SequenceSpaceJacobians_Transition_Matrix_Example_30_1.png" />
</div>
</div>
</section>
<section id="Calculating-the-Path-of-Consumption-given-an-Perfect-foresight-MIT-shock">
<h3>Calculating the Path of Consumption given an Perfect foresight MIT shock<a class="headerlink" href="#Calculating-the-Path-of-Consumption-given-an-Perfect-foresight-MIT-shock" title="Link to this heading">#</a></h3>
<p>This section details an experiment to exhibit how to the transition matrix method can be utilized to compute the paths of aggregate consumption and aggregate assets given a pertubation in a variable for one period. In particular, in this experiment, in period t=0, agents learn that there will be a shock in the interest rate in period t=10. Given this, the simulated paths of aggregate consumption and aggregate assets will be computed and plotted.</p>
<section id="Compute-Steady-State-Distribution">
<h4>Compute Steady State Distribution<a class="headerlink" href="#Compute-Steady-State-Distribution" title="Link to this heading">#</a></h4>
<p>We will want the simulation to begin at the economy’s steady state. Therefore first we will compute the steady state distribution over market resources and permanent income. This will be the distribution for which the computed transition matrices will be applied/multiplied to.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ss</span> <span class="o">=</span> <span class="n">NewKeynesianConsumerType</span><span class="p">(</span><span class="o">**</span><span class="n">Dict</span><span class="p">)</span>
<span class="n">ss</span><span class="o">.</span><span class="n">cycles</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">ss</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Simulating-With-Harmenberg-(2021)-Method">
<h3>Simulating With Harmenberg (2021) Method<a class="headerlink" href="#Simulating-With-Harmenberg-(2021)-Method" title="Link to this heading">#</a></h3>
<p>Harmenberg (2021) method may also be implemented when simulating with transition matrices. In the following cells, we compute the steady distribution using Harmenberg’s method.</p>
<p>For more information on Harmenberg’s Method to dramatically improve simulation times see <a class="reference external" href="https://econ-ark.org/materials/harmenberg-aggregation?launch">https://econ-ark.org/materials/harmenberg-aggregation?launch</a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Change the income process to use Neutral Measure</span>
<span class="n">ss</span><span class="o">.</span><span class="n">neutral_measure</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">ss</span><span class="o">.</span><span class="n">update_income_process</span><span class="p">()</span>

<span class="n">ss</span><span class="o">.</span><span class="n">mCount</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">ss</span><span class="o">.</span><span class="n">mMax</span> <span class="o">=</span> <span class="mi">3000</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up grid and calculate steady state transition Matrices</span>

<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">ss</span><span class="o">.</span><span class="n">define_distribution_grid</span><span class="p">()</span>
<span class="n">ss</span><span class="o">.</span><span class="n">calc_transition_matrix</span><span class="p">()</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">cPol_Grid</span>  <span class="c1"># Normalized Consumption Policy grid</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">aPol_Grid</span>  <span class="c1"># Normalized Asset Policy grid</span>

<span class="n">ss</span><span class="o">.</span><span class="n">calc_ergodic_dist</span><span class="p">()</span>  <span class="c1"># Calculate steady state distribution</span>
<span class="n">vecDstn_fast</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">vec_erg_dstn</span>  <span class="c1"># Distribution as a vector (mx1) where m is the number of gridpoint on the market resources grid</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Seconds to calculate both the transition matrix and the steady state distribution with Harmenberg&quot;</span><span class="p">,</span>
    <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">AggA_fast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ss</span><span class="o">.</span><span class="n">aPol_Grid</span><span class="p">,</span> <span class="n">vecDstn_fast</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Seconds to calculate both the transition matrix and the steady state distribution with Harmenberg 7.042428731918335
</pre></div></div>
</div>
<p>Computing the transition matrix and ergodic distribution with the harmenberg measure is significantly faster. (Note the number of gridpoints on the market resources grid is 1000 instead of 90.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">aLvls</span><span class="p">[</span><span class="mi">100</span><span class="p">:],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Monte Carlo&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># Plot time series path of aggregate assets using Monte Carlo simulation methods</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">example1</span><span class="o">.</span><span class="n">T_sim</span> <span class="o">-</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="n">AggA</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;transition matrix&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># Plot time series path of aggregate assets computed using transition matrix</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">example1</span><span class="o">.</span><span class="n">T_sim</span> <span class="o">-</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="n">AggA_fast</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;transition matrix _harmenberg&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># Plot time series path of aggregate assets computed using transition matrix</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Aggregate Assets&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_SequenceSpaceJacobians_Transition_Matrix_Example_38_0.png" src="../../_images/examples_SequenceSpaceJacobians_Transition_Matrix_Example_38_0.png" />
</div>
</div>
<section id="Note*-Increasing-the-number-of-gridpoints-increases-the-accuracy-of-the-transition-matrix-method">
<h4>Note* Increasing the number of gridpoints increases the accuracy of the transition matrix method<a class="headerlink" href="#Note*-Increasing-the-number-of-gridpoints-increases-the-accuracy-of-the-transition-matrix-method" title="Link to this heading">#</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Agg_AVals</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">mpoints</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">3000</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mpoints</span><span class="p">:</span>
    <span class="n">ss</span><span class="o">.</span><span class="n">mCount</span> <span class="o">=</span> <span class="n">i</span>

    <span class="n">ss</span><span class="o">.</span><span class="n">define_distribution_grid</span><span class="p">()</span>
    <span class="n">ss</span><span class="o">.</span><span class="n">calc_transition_matrix</span><span class="p">()</span>

    <span class="n">ss</span><span class="o">.</span><span class="n">calc_ergodic_dist</span><span class="p">()</span>  <span class="c1"># Calculate steady state distribution</span>
    <span class="n">vecDstn_fast</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">vec_erg_dstn</span>  <span class="c1"># Distribution as a vector (mx1) where m is the number of gridpoint on the market resources grid</span>
    <span class="n">Asset_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ss</span><span class="o">.</span><span class="n">aPol_Grid</span><span class="p">,</span> <span class="n">vecDstn_fast</span><span class="p">)</span>

    <span class="n">Agg_AVals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Asset_val</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Agg_AVals</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">example1</span><span class="o">.</span><span class="n">T_sim</span> <span class="o">-</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="n">Agg_AVals</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;gridpoints = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mpoints</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">aLvls</span><span class="p">[</span><span class="mi">100</span><span class="p">:],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Monte Carlo&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># Plot time series path of aggregate assets using Monte Carlo simulation methods</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Aggregate Assets&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_SequenceSpaceJacobians_Transition_Matrix_Example_41_0.png" src="../../_images/examples_SequenceSpaceJacobians_Transition_Matrix_Example_41_0.png" />
</div>
</div>
<p>Note the Harmenberg method not only reduces the time of computation but also improves the accuracy of the simulated path of assets.</p>
</section>
<section id="Monte-Carlo-Simulation-with-Harmenberg-Trick">
<h4>Monte Carlo Simulation with Harmenberg Trick<a class="headerlink" href="#Monte-Carlo-Simulation-with-Harmenberg-Trick" title="Link to this heading">#</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ss</span><span class="o">.</span><span class="n">AgentCount</span> <span class="o">=</span> <span class="mi">25000</span>
<span class="n">ss</span><span class="o">.</span><span class="n">T_sim</span> <span class="o">=</span> <span class="mi">700</span>
<span class="n">ss</span><span class="o">.</span><span class="n">initialize_sim</span><span class="p">()</span>
<span class="n">ss</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{}
</pre></div></div>
</div>
</section>
</section>
<section id="Solve-an-Agent-who-Anticipates-a-Change-in-the-Real-Interest-Rate">
<h3>Solve an Agent who Anticipates a Change in the Real Interest Rate<a class="headerlink" href="#Solve-an-Agent-who-Anticipates-a-Change-in-the-Real-Interest-Rate" title="Link to this heading">#</a></h3>
<p>Now that we have the steady state distributions of which simulations will begin from, we will now solve an agent who anticipates a change in the real rate in period t=10. I first solve the agent’s problem provide the consumption policies to be used to calculate the transition matrices of this economy.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We will solve a finite horizon problem that begins at the steady state computed above.</span>
<span class="c1"># Therefore parameters must be specified as lists, each item&#39;s index indicating the period of the horizon.</span>

<span class="n">params</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">Dict</span><span class="p">)</span>
<span class="n">params</span><span class="p">[</span><span class="s2">&quot;T_cycle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">params</span><span class="p">[</span><span class="s2">&quot;LivPrb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;T_cycle&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">[</span><span class="n">ss</span><span class="o">.</span><span class="n">LivPrb</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">params</span><span class="p">[</span><span class="s2">&quot;PermGroFac&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;T_cycle&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span>
<span class="n">params</span><span class="p">[</span><span class="s2">&quot;PermShkStd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;T_cycle&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">[</span><span class="n">ss</span><span class="o">.</span><span class="n">PermShkStd</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">params</span><span class="p">[</span><span class="s2">&quot;TranShkStd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;T_cycle&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">[</span><span class="n">ss</span><span class="o">.</span><span class="n">TranShkStd</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">params</span><span class="p">[</span><span class="s2">&quot;tax_rate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;T_cycle&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">[</span><span class="n">ss</span><span class="o">.</span><span class="n">tax_rate</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">params</span><span class="p">[</span><span class="s2">&quot;labor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;T_cycle&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">[</span><span class="n">ss</span><span class="o">.</span><span class="n">labor</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">params</span><span class="p">[</span><span class="s2">&quot;wage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;T_cycle&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">[</span><span class="n">ss</span><span class="o">.</span><span class="n">wage</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">params</span><span class="p">[</span><span class="s2">&quot;Rfree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;T_cycle&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">[</span><span class="n">ss</span><span class="o">.</span><span class="n">Rfree</span><span class="p">]</span>
<span class="n">params</span><span class="p">[</span><span class="s2">&quot;DiscFac&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;T_cycle&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">[</span><span class="n">ss</span><span class="o">.</span><span class="n">DiscFac</span><span class="p">]</span>

<span class="n">FinHorizonAgent</span> <span class="o">=</span> <span class="n">NewKeynesianConsumerType</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
<span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">cycles</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">del_from_time_inv</span><span class="p">(</span>
    <span class="s2">&quot;Rfree&quot;</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># delete Rfree from time invariant list since it varies overtime</span>
<span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">add_to_time_vary</span><span class="p">(</span><span class="s2">&quot;Rfree&quot;</span><span class="p">)</span>

<span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">del_from_time_inv</span><span class="p">(</span>
    <span class="s2">&quot;DiscFac&quot;</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># delete Rfree from time invariant list since it varies overtime</span>
<span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">add_to_time_vary</span><span class="p">(</span><span class="s2">&quot;DiscFac&quot;</span><span class="p">)</span>

<span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">IncShkDstn</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;T_cycle&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">[</span><span class="n">ss</span><span class="o">.</span><span class="n">IncShkDstn</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">cFunc_terminal_</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span>
    <span class="n">ss</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cFunc</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># Set Terminal Solution as Steady State Consumption Function</span>
<span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">track_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cNrm&quot;</span><span class="p">,</span> <span class="s2">&quot;pLvl&quot;</span><span class="p">,</span> <span class="s2">&quot;aNrm&quot;</span><span class="p">]</span>
<span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">T_sim</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;T_cycle&quot;</span><span class="p">]</span>
<span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">AgentCount</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">AgentCount</span>
</pre></div>
</div>
</div>
<section id="Implement-perturbation-in-Real-Interest-Rate">
<h4>Implement perturbation in Real Interest Rate<a class="headerlink" href="#Implement-perturbation-in-Real-Interest-Rate" title="Link to this heading">#</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dx</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="c1"># Change in the Interest Rate</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># Period in which the change in the interest rate occurs</span>

<span class="n">R</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">Rfree</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">Rfree</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="n">R</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">R</span> <span class="o">+</span> <span class="n">dx</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;T_cycle&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="n">R</span><span class="p">]</span>
<span class="p">)</span>  <span class="c1"># Sequence of interest rates the agent faces</span>

<span class="c1"># FinHorizonAgent.DiscFac = (i)*[ss.DiscFac] + [ss.DiscFac + dx] + (params[&#39;T_cycle&#39;] - i -1 )*[ss.DiscFac] # Sequence of interest rates the agent faces</span>
</pre></div>
</div>
</div>
</section>
<section id="Solve-Agent">
<h4>Solve Agent<a class="headerlink" href="#Solve-Agent" title="Link to this heading">#</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Simulate-with-Monte-Carlo-with-Harmenberg-Trick">
<h4>Simulate with Monte Carlo with Harmenberg Trick<a class="headerlink" href="#Simulate-with-Monte-Carlo-with-Harmenberg-Trick" title="Link to this heading">#</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulate with Monte Carlo</span>

<span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">PerfMITShk</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># Use Harmenberg Improvement for Monte Carlo</span>
<span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">neutral_measure</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">update_income_process</span><span class="p">()</span>

<span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">initialize_sim</span><span class="p">()</span>

<span class="c1"># Begin simulation at steady state distribution of permanent income and permanent income</span>
<span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">state_now</span><span class="p">[</span><span class="s2">&quot;aNrm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">state_now</span><span class="p">[</span><span class="s2">&quot;aNrm&quot;</span><span class="p">]</span>
<span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">state_now</span><span class="p">[</span><span class="s2">&quot;pLvl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">state_now</span><span class="p">[</span><span class="s2">&quot;pLvl&quot;</span><span class="p">]</span>
<span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">state_now</span><span class="p">[</span><span class="s2">&quot;mNrm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">state_now</span><span class="p">[</span><span class="s2">&quot;mNrm&quot;</span><span class="p">]</span>

<span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;seconds past : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>

<span class="c1"># Compute path of aggregate consumption</span>
<span class="n">clvl</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">alvl</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">T_sim</span><span class="p">):</span>
    <span class="c1"># C = np.mean(FinHorizonAgent.history[&#39;pLvl&#39;][i,:]*(FinHorizonAgent.history[&#39;cNrm&#39;][i,:]  )) #Aggregate Consumption for period i</span>

    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
        <span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">&quot;cNrm&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span>
    <span class="p">)</span>  <span class="c1"># Aggregate Consumption for period i</span>

    <span class="n">clvl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>

    <span class="c1"># A = np.mean(FinHorizonAgent.history[&#39;pLvl&#39;][i,:]*FinHorizonAgent.history[&#39;aNrm&#39;][i,:]) #Aggregate Consumption for period i</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
        <span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">&quot;aNrm&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span>
    <span class="p">)</span>  <span class="c1"># Aggregate Consumption for period i</span>

    <span class="n">alvl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
seconds past : 0.3090834617614746
</pre></div></div>
</div>
</section>
<section id="Calculate-Transition-Matrices-with-Neutral-Measure-(Harmenberg-2021)">
<h4>Calculate Transition Matrices with Neutral Measure (Harmenberg 2021)<a class="headerlink" href="#Calculate-Transition-Matrices-with-Neutral-Measure-(Harmenberg-2021)" title="Link to this heading">#</a></h4>
<p>After the agent solves his problem, the consumption policies are stored in the solution attribute of self. calc_transition_matrix() will automatically call these attributes to compute the transition matrices.</p>
<p>In the cell below we calculate the transition matrix while utilizing the neutral measure for speed efficiency.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Change Income Process to allow permanent income shocks to be drawn from neutral measure</span>
<span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">mCount</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">mCount</span>
<span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">mMax</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">mMax</span>

<span class="c1"># Calculate Transition Matrices</span>
<span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">define_distribution_grid</span><span class="p">()</span>

<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">calc_transition_matrix</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Seconds to calc_transition_matrix&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Seconds to calc_transition_matrix 0.9972240924835205
</pre></div></div>
</div>
</section>
<section id="Compute-Path-of-Aggregate-Consumption">
<h4>Compute Path of Aggregate Consumption<a class="headerlink" href="#Compute-Path-of-Aggregate-Consumption" title="Link to this heading">#</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">AggC_fast</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List of aggregate consumption for each period t</span>
<span class="n">AggA_fast</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List of aggregate consumption for each period t</span>

<span class="n">dstn</span> <span class="o">=</span> <span class="n">vecDstn_fast</span>  <span class="c1"># Initial distribution set as steady state distribution</span>

<span class="n">c_</span> <span class="o">=</span> <span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">cPol_Grid</span>  <span class="c1"># Consumption Policy Grid this period</span>
<span class="n">a_</span> <span class="o">=</span> <span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">aPol_Grid</span>  <span class="c1"># asset policy grid</span>

<span class="n">c_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="n">a_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">T_mat</span> <span class="o">=</span> <span class="n">FinHorizonAgent</span><span class="o">.</span><span class="n">tran_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">dstn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">T_mat</span><span class="p">,</span> <span class="n">dstn</span><span class="p">)</span>

    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c_</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dstn</span><span class="p">)</span>  <span class="c1"># Compute Aggregate Consumption this period</span>
    <span class="n">AggC_fast</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a_</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dstn</span><span class="p">)</span>  <span class="c1"># Compute Aggregate Assets this period</span>
    <span class="n">AggA_fast</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">AggC_fast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">AggC_fast</span><span class="p">)</span>
<span class="n">AggC_fast</span> <span class="o">=</span> <span class="n">AggC_fast</span><span class="o">.</span><span class="n">T</span>

<span class="n">AggA_fast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">AggA_fast</span><span class="p">)</span>
<span class="n">AggA_fast</span> <span class="o">=</span> <span class="n">AggA_fast</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
</section>
<section id="Path-of-Aggregate-Consumption-given-an-anticipated-interest-rate-shock-at-t=10">
<h4>Path of Aggregate Consumption given an anticipated interest rate shock at <span class="math notranslate nohighlight">\(t=10\)</span><a class="headerlink" href="#Path-of-Aggregate-Consumption-given-an-anticipated-interest-rate-shock-at-t=10" title="Link to this heading">#</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plt.plot(AggC, label = &#39;without Harmenberg&#39;) #Without Neutral Measure</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">AggC_fast</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot; Transition Matrices&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># With Harmenberg Improvement</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">clvl</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Monte Carlo&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># Monte Carlo with Hamenberg Improvement</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">1.08</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_SequenceSpaceJacobians_Transition_Matrix_Example_58_0.png" src="../../_images/examples_SequenceSpaceJacobians_Transition_Matrix_Example_58_0.png" />
</div>
</div>
</section>
<section id="Path-of-Aggregate-Assets-given-an-anticipated-interest-rate-shock-at-t=10">
<h4>Path of Aggregate Assets given an anticipated interest rate shock at <span class="math notranslate nohighlight">\(t=10\)</span><a class="headerlink" href="#Path-of-Aggregate-Assets-given-an-anticipated-interest-rate-shock-at-t=10" title="Link to this heading">#</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">AggA_fast</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot; Transition Matrices&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># With Harmenberg Improvement</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alvl</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Monte Carlo&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_SequenceSpaceJacobians_Transition_Matrix_Example_60_0.png" src="../../_images/examples_SequenceSpaceJacobians_Transition_Matrix_Example_60_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../LifecycleModel/LifecycleModel.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">A Life Cycle Model: The Distribution of Assets By Age</p>
      </div>
    </a>
    <a class="right-next"
       href="Jacobian_Example.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Computing Heterogenous Agent Sequence Space Jacobians in HARK</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define_distribution_grid">define_distribution_grid</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calc_ergodic_dist">calc_ergodic_dist</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Set-up-Computational-Environment">Set up Computational Environment</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Set-up-the-Dictionary">Set up the Dictionary</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Create-an-Instance-of-IndShockConsumerType-and-Solve">Create an Instance of IndShockConsumerType and Solve</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Simulation:-Transition-Matrix-vs-Monte-Carlo">Simulation: Transition Matrix vs Monte Carlo</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Method-1:-Monte-Carlo">Method 1: Monte Carlo</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Method-2:-Transition-Matrices">Method 2: Transition Matrices</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#Comparing-Steady-State-Outputs-of-Both-Methods">Comparing Steady State Outputs of Both Methods</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#Comparing-Simulated-Path-of-Aggregate-Assets">Comparing Simulated Path of Aggregate Assets</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#Precision-vs-Accuracy">Precision vs Accuracy</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Distribution-of-Normalized-Market-Resources">Distribution of Normalized Market Resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Distributions-of-Permanent-Income">Distributions of Permanent Income</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Distribution-of-Wealth">Distribution of Wealth</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Distribution-of-Liquid-Assets">Distribution of Liquid Assets</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Calculating-the-Path-of-Consumption-given-an-Perfect-foresight-MIT-shock">Calculating the Path of Consumption given an Perfect foresight MIT shock</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#Compute-Steady-State-Distribution">Compute Steady State Distribution</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Simulating-With-Harmenberg-(2021)-Method">Simulating With Harmenberg (2021) Method</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#Note*-Increasing-the-number-of-gridpoints-increases-the-accuracy-of-the-transition-matrix-method">Note* Increasing the number of gridpoints increases the accuracy of the transition matrix method</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#Monte-Carlo-Simulation-with-Harmenberg-Trick">Monte Carlo Simulation with Harmenberg Trick</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Solve-an-Agent-who-Anticipates-a-Change-in-the-Real-Interest-Rate">Solve an Agent who Anticipates a Change in the Real Interest Rate</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#Implement-perturbation-in-Real-Interest-Rate">Implement perturbation in Real Interest Rate</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#Solve-Agent">Solve Agent</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#Simulate-with-Monte-Carlo-with-Harmenberg-Trick">Simulate with Monte Carlo with Harmenberg Trick</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#Calculate-Transition-Matrices-with-Neutral-Measure-(Harmenberg-2021)">Calculate Transition Matrices with Neutral Measure (Harmenberg 2021)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#Compute-Path-of-Aggregate-Consumption">Compute Path of Aggregate Consumption</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#Path-of-Aggregate-Consumption-given-an-anticipated-interest-rate-shock-at-t=10">Path of Aggregate Consumption given an anticipated interest rate shock at <span class="math notranslate nohighlight">\(t=10\)</span></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#Path-of-Aggregate-Assets-given-an-anticipated-interest-rate-shock-at-t=10">Path of Aggregate Assets given an anticipated interest rate shock at <span class="math notranslate nohighlight">\(t=10\)</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, Econ-ARK team.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>